import{r as u,j as r,I as be}from"./index-Cq4ejKLT.js";import{s as ye,d as ne,a as se,g as we,i as je,b as ve,P as oe,A as Se,S as Ee,c as ue}from"./ShareModal-Cn_oAQ-N.js";import{a as Ne,f as Te,k as ie,m as le}from"./cookieUtils-CWdrEs-e.js";function L(e){return String(e).padStart(2,"0")}function j(e){const t=Number(e);return Number.isFinite(t)?t.toFixed(2):"0.00"}function _(){const e=new Date(Date.now()+324e5);return{y:e.getUTCFullYear(),m:e.getUTCMonth()+1,d:e.getUTCDate()}}function Oe(){const e=_();return`${e.y}-${L(e.m)}-${L(e.d)}`}const ke=120,Me=.6;function $e(e){let t=2166136261;for(let i=0;i<e.length;i++)t^=e.charCodeAt(i),t=Math.imul(t,16777619);return t>>>0}function Re(e){return function(){let t=(e+=1831565813)>>>0;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}}const z={목:Array.from({length:9},(e,t)=>1+t),화:Array.from({length:9},(e,t)=>10+t),토:Array.from({length:9},(e,t)=>19+t),금:Array.from({length:9},(e,t)=>28+t),수:Array.from({length:9},(e,t)=>37+t)},k=["목","화","토","금","수"],Fe=e=>k[(k.indexOf(e)+4)%5],ae=e=>k[(k.indexOf(e)+1)%5],Ae=e=>k[(k.indexOf(e)+2)%5],ce=e=>k[(k.indexOf(e)+3)%5];function Ce(e){if(!e)return null;if(e?.sajuResult?.year&&e?.sajuResult?.month&&e?.sajuResult?.day&&e?.sajuResult?.hour)return e;const t=e.calendar||"solar",i=Number(e.year),n=Number(e.month),m=Number(e.day),a=Number(e.hour??0),d=Number(e.minute??0),b=e.leapMonth==="leap"||e.isLeap===!0;let o,l,f;if(typeof e.solarDate=="string"){const v=String(e.solarDate).match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);v&&(o=Number(v[1]),l=Number(v[2]),f=Number(v[3]))}if(!o||!l||!f)if(t==="lunar"){const v=Te(i,n,m,b),N=v instanceof Date?v:new Date(v);o=N.getFullYear(),l=N.getMonth()+1,f=N.getDate()}else o=i,l=n,f=m;const M=ue(o,l,f,a,d);return{...e,calendar:t,solarDate:`${o}-${L(l)}-${L(f)}`,sajuResult:M,year:i,month:n,day:m,hour:a,minute:d}}function De(){const e=_();return ue(e.y,e.m,e.d,12,0)}function He(e,t){const i=Object.entries(t).filter(([,a])=>a>0),n=i.reduce((a,[,d])=>a+d,0);if(!i.length||n<=0)return null;let m=e()*n;for(const[a,d]of i){if(m<d)return a;m-=d}return i[i.length-1][0]}function Be(e,t,i,n,m){const a=(e.목+e.화+e.토+e.금+e.수)/5,d={목:Math.max(0,a-(e.목||0)),화:Math.max(0,a-(e.화||0)),토:Math.max(0,a-(e.토||0)),금:Math.max(0,a-(e.금||0)),수:Math.max(0,a-(e.수||0))};if(t){const o=(l,f)=>d[l]=Math.max(0,(d[l]||0)+f);i.level==="신약"?(o(Fe(t),1),o(ae(t),.35),o(t,.25)):i.level==="신강"?(o(ce(t),.85),o(Ae(t),.35),d[t]=Math.max(0,(d[t]||0)-.25)):(o(ae(t),.15),o(ce(t),.15))}const b=.25;if(["목","화","토","금","수"].forEach(o=>{const l=(n[o]||0)*b;d[o]=Math.max(0,(d[o]||0)+l)}),m&&m.length)for(const o of m)d[o]=Math.max(0,(d[o]||0)+.6);return d}function Le(e){return e>=1&&e<=9?"목":e>=10&&e<=18?"화":e>=19&&e<=27?"토":e>=28&&e<=36?"금":e>=37&&e<=45?"수":""}function de(e){switch(e){case"목":return"el-wood";case"화":return"el-fire";case"토":return"el-earth";case"금":return"el-metal";case"수":return"el-water";default:return""}}function Pe(e,t){const i={목:[...z.목],화:[...z.화],토:[...z.토],금:[...z.금],수:[...z.수]},n=new Set,m=[],a={},d=Object.entries(t).sort((o,l)=>l[1]-o[1]).map(([o])=>o),b={...t};for(let o=0;o<6;o++){let l=He(e,b)||d[o%d.length];b[l]=Math.max(0,(b[l]||0)*.88);let f=null,M=0;for(;M++<16;){if(!i[l]?.length){const H=Object.keys(i).filter(G=>i[G].length>0);if(!H.length)break;l=H[Math.floor(e()*H.length)]}const v=Math.floor(e()*i[l].length),N=i[l][v];if(!n.has(N)){f=N,i[l].splice(v,1);break}}f!=null&&(n.add(f),m.push(f),a[f]=l)}return m.sort((o,l)=>o-l),{main:m,mapping:a}}const I=["목","화","토","금","수"];function ze(e){if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const i=window.getComputedStyle(t);if(/(auto|scroll|overlay)/.test(i.overflowY)||/(auto|scroll|overlay)/.test(i.overflow))return t;t=t.parentElement}return null}function K(e){if(e)return{scrollTop:e.scrollTop,clientHeight:e.clientHeight,scrollHeight:e.scrollHeight};const t=document.scrollingElement||document.documentElement;return{scrollTop:t.scrollTop,clientHeight:window.innerHeight||t.clientHeight,scrollHeight:t.scrollHeight}}const We=()=>{const e="로또 숫자",[t,i]=u.useState([]),[n,m]=u.useState(null),[a,d]=u.useState(null),[b,o]=u.useState(null),[l,f]=u.useState(null),[M,v]=u.useState(null),[N,H]=u.useState(""),[G,J]=u.useState(""),[he,q]=u.useState(!1),[U,Q]=u.useState(!1),[V,Y]=u.useState(!1),X=u.useRef(null),Z=u.useRef(null),$=u.useRef(!1),ee=u.useRef(0),B=u.useRef(!1),P=u.useMemo(()=>Oe(),[]);return u.useEffect(()=>{ye({title:`${e} | 운세뉴스`,description:"쿠키의 생년월일과 오늘 사주를 반영해 확률 가중 추출한 6/45 숫자(5세트).",path:"/#/lotto",image:"/og-image.png"})},[]),u.useEffect(()=>{let s=null;try{s=Ne()}catch{}const x=!!(s&&s.hour!==""&&s.hour!==null&&s.hour!==void 0&&!Number.isNaN(Number(s.hour)));if(!s||!x){Q(!0);return}Q(!1);const y=De();o(y);const S=ne(y,{includeHidden:!1}),h=Ce(s),w=h.sajuResult;d(w);const R={y:h.year,m:h.month,d:h.day,hh:h.hour??0,mm:h.minute??0,gender:h.gender||"unknown",yearStem:w?.year?.stem},T=se(w,{birth:R});f(T);const W={y:_().y,m:_().m,d:_().d,hh:12,mm:0,yearStem:y?.year?.stem,mode:"today"},F=se(y,{birth:W,anchorDayStem:w?.day?.stem});v(F);const c=ne(w,{includeHidden:!0}),E=we(w?.day?.stem),g=je(w),O=[].concat(T?.yongshin?.primary?[T.yongshin.primary]:[]).concat(T?.yongshin?.secondary?[T.yongshin.secondary]:[]).filter(Boolean),A=Be(c,E,g,S,O),C=I.reduce((p,D)=>p+(A[D]||0),0)||1,te=Object.fromEntries(I.map(p=>[p,(A[p]||0)/C])),pe=Object.fromEntries(I.map(p=>[p,te[p]*6])),me=[h.calendar||"solar",`${h.year}-${h.month}-${h.day}`,`${L(h.hour||0)}:${L(h.minute||0)}`,h.gender||"",w?.day?.stem||""].join("|"),fe=`lotto5-weighted|${P}|${me}`,re=[];for(let p=1;p<=5;p++){const D=Re($e(`${fe}|G${p}`));re.push(Pe(D,A))}i(re);const xe=Object.entries(c).sort((p,D)=>p[1]-D[1]).map(([p])=>p),ge=Object.entries(S).sort((p,D)=>D[1]-p[1]).map(([p])=>p);m({baseWeights:A,probs:te,expected:pe,myCounts:c,todayCounts:S,dm:E,strength:g,weakestOrder:xe,todayTop:ge,yongEls:O})},[P]),u.useEffect(()=>{!a||!b||!l||!M||!t?.length||!n||(async()=>{q(!0),J(""),H("");try{const s={dateKST:P,games:t.map((w,R)=>({idx:R+1,numbers:w.main,mapping:w.mapping})),weights:n.baseWeights,probs:n.probs,expected:n.expected},x={pillars:{birth:a,today:b},meta:{birth:l,today:M},lotto:s},y=["당신은 신중한 한국어 명리 해설가입니다.","오직 제공된 JSON(출생/오늘 4주, meta: 용신·기신·십성·신살·합충형해파·오행분포·격국 등, 그리고 뽑힌 숫자/오행 매핑/가중치)만으로 설명하세요.","과장·단정·보장 표현 금지(특히 당첨 보장/확률 언급 금지), 외부 데이터/추정 금지.","제목/서론/결론 없이 아래 소제목만 h3(###)로 출력하세요.","소제목: 총평, 숫자군 해설, 상호작용 포인트(용신·기신), 십성·신살 관점, 오늘 톤 활용팁, 주의 사항","각 항목은 250~450자, 반복/상투어 금지, 구체 근거(오행·합충 등)로 설명."].join(" "),S=["분석 JSON:","```json",JSON.stringify(x,null,2),"```","","지침:","- 숫자 자체의 길흉을 단정하지 말고, 왜 이런 오행군으로 가중되었는지 설명하세요.","- 용신/기신, 합·충·형·해·파·원진, 십성(육친)과 오늘 톤을 연결해 해석하세요.","- 도박/투자 조언처럼 들리는 표현, 확률/승률/수익 언급은 금지합니다."].join(`
`),h=await ve({messages:[{role:"system",content:y},{role:"user",content:S}],cacheKey:`LOTTO|${P}|${a?.day?.stem||""}`});H(String(h||"").trim())}catch(s){J(s?.message||"AI 해설 생성 중 오류가 발생했습니다.")}finally{q(!1)}})()},[a,b,l,M,t,n,P]),u.useEffect(()=>{if(U||typeof window>"u")return;const s=ze(X.current),x=Array.from(new Set([s,window])).filter(Boolean),y=Math.max(48,Math.round((window.innerHeight||0)*.08)),{scrollTop:S}=K(s||null);ee.current=S,B.current=!1;const h=c=>{const{clientHeight:E,scrollHeight:g}=K(c===window?null:c);return g-E>80},w=c=>{if($.current||!B.current||!h(c)||ie())return;const{scrollTop:E,clientHeight:g,scrollHeight:O}=K(c===window?null:c);E+g>=O-y&&($.current=!0,le(),Y(!0))};let R=!1;const T=()=>{R||(R=!0,requestAnimationFrame(()=>{R=!1;const{scrollTop:c,clientHeight:E,scrollHeight:g}=K(s||null),O=Math.abs(c-ee.current),A=g>0?(c+E)/g:0;!B.current&&(O>=ke||A>=Me)&&(B.current=!0);for(const C of x)if(w(C),$.current)break}))},W=()=>{if(!(!B.current||$.current)){for(const c of x)if(w(c),$.current)break}};for(const c of x)c.addEventListener("scroll",T,{passive:!0});window.addEventListener("resize",W);const F=[];if("IntersectionObserver"in window){const c=Z?.current;if(c){const E=g=>new IntersectionObserver(O=>{O.some(C=>C.isIntersecting)&&!$.current&&B.current&&h(g)&&!ie()&&($.current=!0,le(),Y(!0),F.forEach(C=>C.disconnect()))},{root:g===window?null:g,threshold:1,rootMargin:"0px"});s&&F.push(E(s)),F.push(E(window)),F.forEach(g=>g.observe(c))}}return()=>{for(const c of x)c.removeEventListener("scroll",T);window.removeEventListener("resize",W),F.forEach(c=>c.disconnect())}},[U]),U?r.jsx("section",{className:"calculator","aria-label":"안내",children:r.jsx(be,{homeHref:"/"})}):r.jsxs("section",{ref:X,className:"calculator","aria-label":`${e} 페이지`,children:[r.jsxs("div",{className:"card result",children:[r.jsx("h2",{children:e}),r.jsxs("div",{className:"grid-two",style:{marginTop:4},children:[r.jsxs("div",{className:"mini-box",children:[r.jsx("div",{className:"mini-title",children:"내 사주 기둥"}),a?r.jsx(oe,{pillars:a,sajuResult:a}):"—"]}),r.jsxs("div",{className:"mini-box",children:[r.jsx("div",{className:"mini-title",children:"오늘 사주 기둥 (정오 기준)"}),b?r.jsx(oe,{pillars:b,sajuResult:b}):"—"]})]}),r.jsx("div",{className:"per-game",style:{marginTop:12},children:t.map((s,x)=>r.jsxs("div",{className:"chips-line",children:[r.jsxs("span",{className:"chip-badge","aria-hidden":!0,children:["G",x+1]}),r.jsx("div",{className:"chips",role:"list","aria-label":`게임 ${x+1} 번호`,children:s.main.map(y=>{const S=s.mapping[y]||Le(y);return r.jsxs("span",{className:"chip",role:"listitem","aria-label":`번호 ${y} • ${S}`,children:[r.jsx("b",{children:String(y).padStart(2,"0")}),r.jsx("i",{className:`ball ${de(S)}`,"aria-hidden":!0,children:S})]},`n-${x}-${y}`)})})]},`pg-${x}`))}),r.jsxs("div",{className:"info-box",style:{marginTop:12},children:[r.jsx("strong",{style:{display:"block",marginBottom:8},children:"왜 이 숫자인가요?"}),r.jsxs("ul",{className:"why-list",children:[r.jsxs("li",{children:[r.jsx("b",{children:"가중치(Weights)"}),"는 내 사주 오행 분포(간·지·장간)에서 상대적으로 부족한 오행을 보정하고, 일간(",n?.dm||"—",")의 상태(",n?.strength?.level||"—",")에 따라",n?.strength?.level==="신약"?" 인성·식상을 가산":n?.strength?.level==="신강"?" 재성·관성을 가산":" 순환 항목을 소폭 가산","했으며, 오늘(정오) 사주의 강한 오행(",n?.todayTop?.slice(0,2).join(", ")||"—",")과",n?.yongEls?.length?` 용신(${n.yongEls.join(", ")})`:" ","에 소폭 가점을 더했습니다."]}),n?.myCounts&&r.jsxs("li",{children:[r.jsx("b",{children:"내 오행 분포"})," (간·지·장간): 목 ",j(n.myCounts?.목),", 화 ",j(n.myCounts?.화),", 토 ",j(n.myCounts?.토),", 금 ",j(n.myCounts?.금),", 수 ",j(n.myCounts?.수),n?.weakestOrder?r.jsxs(r.Fragment,{children:[" · ",r.jsx("em",{children:"부족순:"})," ",n.weakestOrder.join(" → ")]}):null]}),r.jsxs("li",{children:[r.jsx("b",{children:"오늘 오행 분포"})," (정오 기준): 목 ",j(n?.todayCounts?.목??0),", 화 ",j(n?.todayCounts?.화??0),", 토 ",j(n?.todayCounts?.토??0),", 금 ",j(n?.todayCounts?.금??0),", 수 ",j(n?.todayCounts?.수??0)]}),r.jsxs("li",{children:[r.jsx("b",{children:"추출 로직"}),": 오행을 확률적으로 선택→해당 오행의 번호군(목 1–9, 화 10–18, 토 19–27, 금 28–36, 수 37–45)에서 중복 없이 6개 추출(선택된 오행은 감쇄×0.88로 편중 억제)."]})]}),r.jsxs("div",{className:"prob-wrap",children:[r.jsx("div",{className:"mini-title",children:"오행 가중치·확률표 (초기 기준)"}),r.jsxs("table",{className:"prob-table","aria-label":"오행 가중치 확률표",children:[r.jsx("thead",{children:r.jsxs("tr",{children:[r.jsx("th",{children:"오행"}),r.jsx("th",{children:"번호 범위"}),r.jsx("th",{children:"가중치"}),r.jsx("th",{children:"확률"}),r.jsx("th",{children:"예상 개수 (6개 중)"})]})}),r.jsx("tbody",{children:I.map(s=>r.jsxs("tr",{children:[r.jsx("td",{className:`elname ${de(s)}`,children:s}),r.jsx("td",{children:s==="목"?"1–9":s==="화"?"10–18":s==="토"?"19–27":s==="금"?"28–36":"37–45"}),r.jsx("td",{children:n?j(n.baseWeights[s]):"0.00"}),r.jsx("td",{children:n?`${j((n.probs[s]||0)*100)}%`:"0.00%"}),r.jsx("td",{children:n?j(n.expected[s]):"0.00"})]},`row-${s}`))}),r.jsx("tfoot",{children:r.jsxs("tr",{children:[r.jsx("td",{colSpan:2,children:"합계"}),r.jsx("td",{children:n?j(I.reduce((s,x)=>s+(n.baseWeights[x]||0),0)):"0.00"}),r.jsx("td",{children:"100.00%"}),r.jsx("td",{children:"6.00"})]})})]}),r.jsxs("p",{className:"helper",style:{marginTop:6},children:["* 표는 ",r.jsx("em",{children:"초기 확률"}),"을 나타냅니다. 실제 추출 중에는 같은 오행 반복을 줄이기 위해 선택 직후 해당 오행 가중치가 감쇄(×0.88)되어 결과가 다소 달라질 수 있습니다."]})]})]}),(N||G)&&r.jsx("div",{style:{marginTop:12},children:r.jsx(Se,{content:N,isLoading:he,error:G})}),r.jsx("div",{ref:Z,style:{height:1}})]}),V&&r.jsx(Ee,{isOpen:V,onClose:()=>Y(!1),pageTitle:e,shareText:"내용이 도움이 되셨다면 지금 공유해보시겠어요?"}),r.jsx("style",{children:`
        .grid-two{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
        @media (max-width: 640px){ .grid-two{ grid-template-columns: 1fr; } }

        /* ⬇️ 테두리 제거: mini-box의 border를 없앱니다 */
        .mini-box{
          border: none;                /* ← 여기서 테두리 제거 */
          border-radius:12px;
          padding:10px 12px;
          background:var(--surface,#fff);
        }
        .mini-title{ font-weight:700; font-size:14px; margin-bottom:6px; color: var(--ink-strong,#111827); }

        .per-game .chips-line{ display:flex; align-items:center; gap:10px; padding: 6px 0; }
        .chip-badge{
          padding: 3px 8px; border:1px solid var(--border,#e5e7eb); border-radius:999px;
          font-size: 12px; background: var(--surface,#fff); color:var(--ink-soft,#6b7280); flex: none;
        }
        .chips{ display:grid; grid-template-columns: repeat(6, minmax(0, 1fr)); gap:8px; width:100%; }
        .chip{
          display:flex; align-items:center; justify-content:center; gap:8px;
          padding:10px 12px; border:1px solid var(--border,#e5e7eb); border-radius:12px; background:var(--surface,#fff);
          min-width:0; white-space: nowrap;
        }
        .chip b{ font-size:16px; letter-spacing:0.02em; line-height:1; }

        .ball{
          display:inline-flex; align-items:center; justify-content:center;
          width:22px; height:22px; border-radius:999px; line-height:1;
          font-style:normal; font-weight:800; font-size:12px;
          border:1px solid var(--border,#e5e7eb);
          background:var(--muted,#f3f4f6); color:var(--ink-soft,#6b7280);
          user-select:none;
        }

        .ball.el-wood, .elname.el-wood{ color:#166534; background:#E8F5E9; border-color:#BFE7CC; }
        .ball.el-fire, .elname.el-fire{ color:#7F1D1D; background:#FEE2E2; border-color:#FBC6C6; }
        .ball.el-earth, .elname.el-earth{ color:#713F12; background:#FEF3C7; border-color:#F3E2A6; }
        .ball.el-metal, .elname.el-metal{ color:#1F2937; background:#E5E7EB; border-color:#D1D5DB; }
        .ball.el-water, .elname.el-water{ color:#1E3A8A; background:#DBEAFE; border-color:#BFDBFE; }

        .info-box{ border:1px solid var(--border,#e5e7eb); border-radius:12px; padding:12px; background:var(--surface,#fff); }
        .why-list{ list-style:none; padding-left:0; margin:8px 0 0; }
        .why-list li{ margin:6px 0; line-height:1.6; color:var(--ink); }

        .prob-wrap{ margin-top:10px; overflow:auto; }
        .prob-table{ width:100%; border-collapse: collapse; font-size:14px; }
        .prob-table th, .prob-table td{ border:1px solid var(--border,#e5e7eb); padding:8px 10px; text-align:center; }
        .prob-table thead th{ background:var(--muted,#f9fafb); font-weight:800; }
        .prob-table tfoot td{ background:var(--muted,#fafafa); font-weight:700; }

        @media (max-width: 640px){
          .per-game .chips-line{ gap: clamp(6px, 1.6vw, 10px); }
          .chips{ gap: clamp(4px, 1.4vw, 8px); }
          .chip{ padding: clamp(5px, 1.4vw, 10px) clamp(6px, 1.8vw, 12px); gap: clamp(3px, 1.2vw, 8px); }
          .chip b{ font-size: clamp(11px, 3.2vw, 16px); }
          .ball{ width: clamp(14px, 4.2vw, 22px); height: clamp(14px, 4.2vw, 22px); font-size: clamp(8px, 2.6vw, 12px); }
          .prob-table{ font-size: 13px; }
          .prob-table th, .prob-table td{ padding:6px 8px; }
        }
        @media (max-width: 380px){ .chips{ grid-template-columns: repeat(3, minmax(0, 1fr)); } }
        @media (max-width: 320px){
          .chips{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
          .chip{ padding: 3px 6px; gap: 2px; }
          .chip b{ font-size: 10px; }
          .ball{ width: 12px; height: 12px; font-size: 7px; }
          .prob-table{ font-size: 12px; }
        }
      `})]})};export{We as default};

import{j as c,a as Nt,r as O}from"./index-Cq4ejKLT.js";import{F as kt,E as _t,t as ot,p as Mt,q as X,r as Q,B as st}from"./cookieUtils-CWdrEs-e.js";const $t={갑:"甲",을:"乙",병:"丙",정:"丁",무:"戊",기:"己",경:"庚",신:"辛",임:"壬",계:"癸"},Tt={자:"子",축:"丑",인:"寅",묘:"卯",진:"辰",사:"巳",오:"午",미:"未",신:"申",유:"酉",술:"戌",해:"亥"};function Ot(e){if(!e)return"";const t=String(e).trim();return/^[甲乙丙丁戊己庚辛壬癸]$/.test(t)?t:$t[t]||t}function It(e){if(!e)return"";const t=String(e).trim();return/^[子丑寅卯辰巳午未申酉戌亥]$/.test(t)?t:Tt[t]||t}function Dt(e){return e?Array.isArray(e)?e.map(t=>t||{stem:"",branch:""}):[e.year,e.month,e.day,e.hour].map(t=>t||{stem:"",branch:""}):[]}function Y(e){return kt[e]||""}function at(e){return _t[e]||""}const Pe=({pillars:e,idPrefix:t=""})=>{const n=Dt(e),r=["연","월","일","시"],o=["year","month","day","hour"];return c.jsx("div",{className:"pillars",children:n.map((s,i)=>{const l=Ot(s?.stem),m=It(s?.branch),u=Y(l)||Y(s?.stem),d=Y(m)||Y(s?.branch),a=o[i],f=t?`${t}-${a}`:void 0;return c.jsxs("div",{className:"pillar","data-type":a,id:f,children:[c.jsx("h3",{children:r[i]}),c.jsxs("div",{className:"pill",children:[c.jsx("span",{className:u,children:l||"—"}),c.jsx("span",{children:"·"}),c.jsx("span",{className:d,children:m||"—"})]}),c.jsx("div",{className:"gx",children:[at(u),at(d)].filter(Boolean).join(" · ")})]},i)})})};function M(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function C(e){return e=e.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(t,n,r)=>`<a href="${M(r)}" target="_blank" rel="noopener noreferrer">${M(n)}</a>`),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e}function Rt(e){if(!e)return"";const t=String(e).replace(/\r\n/g,`
`).split(`
`);let n=0,r="";const o=i=>{const l=[];for(;n<t.length&&i(t[n]);)l.push(t[n++]);return l},s=i=>{const l=i.join(`
`).trim();if(!l)return;const m=l.split(/\n{2,}/).map(u=>`<p>${C(M(u))}</p>`);r+=m.join("")};for(;n<t.length;){const i=t[n];if(/^\s*(-{3,}|\*{3,}|_{3,})\s*$/.test(i)){n++,r+="<hr/>";continue}const l=i.match(/^\s*(#{1,3})\s+(.+)$/);if(l){n++;const u=l[1].length,d=l[2].trim(),a=C(M(d));r+=`<h${u+1}>${a}</h${u+1}>`;continue}if(/^\s*>/.test(i)){const d=o(a=>/^\s*>/.test(a)).map(a=>a.replace(/^\s*>\s?/,"")).join(`
`).split(/\n{2,}/).map(a=>`<p>${C(M(a))}</p>`);r+=`<blockquote>${d.join("")}</blockquote>`;continue}if(/^\s*\d+\.\s+/.test(i)){const u=o(d=>/^\s*\d+\.\s+/.test(d)).map(d=>d.replace(/^\s*\d+\.\s+/,"")).map(d=>`<li>${C(M(d))}</li>`).join("");r+=`<ol>${u}</ol>`;continue}if(/^\s*([-*•])\s+/.test(i)){const u=o(d=>/^\s*([-*•])\s+/.test(d)).map(d=>d.replace(/^\s*([-*•])\s+/,"")).map(d=>`<li>${C(M(d))}</li>`).join("");r+=`<ul>${u}</ul>`;continue}const m=[];for(;n<t.length&&!/^\s*$/.test(t[n]);)m.push(t[n++]);for(s(m);n<t.length&&/^\s*$/.test(t[n]);)n++}return r}const Ct=()=>c.jsxs("div",{className:"ai-loading",role:"img","aria-label":"로딩 중",children:[c.jsxs("svg",{className:"ai-spinner",width:"96",height:"96",viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",children:[c.jsx("defs",{children:c.jsxs("linearGradient",{id:"aiGrad",x1:"0",y1:"0",x2:"1",y2:"1",children:[c.jsx("stop",{offset:"0%",stopColor:"#0a84ff"}),c.jsx("stop",{offset:"50%",stopColor:"#7a5af8"}),c.jsx("stop",{offset:"100%",stopColor:"#0fa958"})]})}),c.jsx("circle",{cx:"48",cy:"48",r:"32",fill:"none",stroke:"url(#aiGrad)",strokeWidth:"4",strokeLinecap:"round",strokeDasharray:"160 60",children:c.jsx("animate",{attributeName:"stroke-dashoffset",from:"0",to:"-440",dur:"1.2s",repeatCount:"indefinite"})}),c.jsx("circle",{cx:"48",cy:"48",r:"24",fill:"none",stroke:"rgba(0,0,0,.08)",strokeWidth:"2",strokeDasharray:"4 6",children:c.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 48 48",to:"360 48 48",dur:"6s",repeatCount:"indefinite"})}),c.jsx("g",{transform:"translate(48,48)",children:c.jsxs("circle",{cx:"0",cy:"-24",r:"3.2",fill:"rgba(10,132,255,.85)",children:[c.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0",to:"360",dur:"1.6s",repeatCount:"indefinite"}),c.jsx("animate",{attributeName:"r",values:"3.2;5;3.2",dur:"1.6s",repeatCount:"indefinite"})]})}),c.jsx("g",{transform:"translate(48,48)",children:c.jsxs("circle",{cx:"0",cy:"18",r:"2.8",fill:"rgba(122,90,248,.9)",children:[c.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"360",to:"0",dur:"2.4s",repeatCount:"indefinite"}),c.jsx("animate",{attributeName:"r",values:"2.8;4;2.8",dur:"2.4s",repeatCount:"indefinite"})]})})]}),c.jsx("style",{children:`
      .ai-loading { display:grid; place-items:center; padding:10px 0 6px; }
      .ai-spinner { filter: drop-shadow(0 4px 18px rgba(122,90,248,.25)); }
      @media (prefers-reduced-motion: reduce){
        .ai-spinner animate, .ai-spinner animateTransform { display:none; }
      }
    `})]}),Ye=({content:e,isLoading:t,error:n})=>{if(t)return c.jsxs("div",{className:"ai-fortune",children:[c.jsxs("div",{className:"content",children:[c.jsx(Ct,{}),c.jsx("p",{"aria-live":"polite",children:"AI가 내용을 준비하는 중…"})]}),c.jsx("style",{children:`
          .ai-fortune .content { max-width:none; width:100%; margin:0; padding-right:0; box-sizing:border-box; }
          .ai-fortune .content p { margin: 10px 0; text-align:center; color: var(--ink-soft, #666); }
        `})]});if(n)return c.jsxs("div",{className:"ai-fortune",children:[c.jsxs("div",{className:"content",role:"alert",children:[c.jsx("p",{children:"사주 풀이 생성 중 오류가 발생했습니다."}),c.jsxs("p",{children:[c.jsx("strong",{children:"오류 내용:"})," ",String(n)]}),c.jsx("p",{children:"API 키/네트워크 또는 CORS 설정을 확인해주세요."})]}),c.jsx("style",{children:`
          .ai-fortune .content { max-width:none; width:100%; margin:0; padding-right:0; box-sizing:border-box; }
          .ai-fortune .content p { margin: 8px 0; line-height:1.7; }
        `})]});if(!e)return null;const r=Rt(e),o={"@context":"https://schema.org","@type":"Article",headline:"AI 사주 풀이",author:{"@type":"Person",name:"AI Fortune"},datePublished:new Date().toISOString(),articleSection:"Horoscope",inLanguage:"ko"};return c.jsxs("div",{className:"ai-fortune",children:[c.jsxs("article",{className:"content",itemScope:!0,itemType:"https://schema.org/Article",children:[c.jsx("div",{itemProp:"articleBody",dangerouslySetInnerHTML:{__html:r}}),c.jsx("meta",{itemProp:"author",content:"AI Fortune"})]}),c.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(o)}}),c.jsx("style",{children:`
        .ai-fortune .content {
          max-width: none !important;
          width: 100% !important;
          margin: 0 !important;
          padding-right: 0 !important;
          box-sizing: border-box;
          line-height: 1.85;
          overflow-wrap: anywhere;
        }
        .ai-fortune .content h2,
        .ai-fortune .content h3,
        .ai-fortune .content h4 { text-align: left; }
        .ai-fortune .content p { margin: 10px 0; }
        .ai-fortune .content ul, 
        .ai-fortune .content ol { margin: 8px 0 8px 18px; }
        .ai-fortune .content a { color: var(--accent, #7a5af8); text-decoration: none; }
        .ai-fortune .content a:hover { text-decoration: underline; }
      `})]})},I=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],H=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],W={甲:"wood",乙:"wood",丙:"fire",丁:"fire",戊:"earth",己:"earth",庚:"metal",辛:"metal",壬:"water",癸:"water"},q={甲:1,丙:1,戊:1,庚:1,壬:1,乙:0,丁:0,己:0,辛:0,癸:0},Ht={子:"water",丑:"earth",寅:"wood",卯:"wood",辰:"earth",巳:"fire",午:"fire",未:"earth",申:"metal",酉:"metal",戌:"earth",亥:"water"},A=(e,t)=>(e%t+t)%t,Ft={子:["癸"],丑:["己","癸","辛"],寅:["甲","丙","戊"],卯:["甲","乙"],辰:["戊","乙","癸"],巳:["丙","戊","庚"],午:["丙","己","丁"],未:["己","乙","丁"],申:["戊","壬","庚"],酉:["辛"],戌:["戊","辛","丁"],亥:["戊","甲","壬"]},Bt={子:"癸",丑:"己",寅:"甲",卯:"乙",辰:"戊",巳:"丙",午:"丙",未:"己",申:"庚",酉:"辛",戌:"戊",亥:"壬"},Pt=["장생","목욕","관대","건록","제왕","쇠","병","사","묘","절","태","양"],Yt={甲:11,乙:6,丙:2,丁:9,戊:2,己:9,庚:5,辛:0,壬:8,癸:3},Lt={亥:{申:"겁살",卯:"육해살",亥:"망신살",午:"재살"}};function it(e,t){if(!e||!t)return"";const n=W[e],r=W[t],o=q[e],s=q[t];return r===n?o===s?"비견":"겁재":n==="wood"&&r==="fire"||n==="fire"&&r==="earth"||n==="earth"&&r==="metal"||n==="metal"&&r==="water"||n==="water"&&r==="wood"?o===s?"식신":"상관":r==="wood"&&n==="fire"||r==="fire"&&n==="earth"||r==="earth"&&n==="metal"||r==="metal"&&n==="water"||r==="water"&&n==="wood"?o===s?"정인":"편인":n==="wood"&&r==="earth"||n==="fire"&&r==="metal"||n==="earth"&&r==="water"||n==="metal"&&r==="wood"||n==="water"&&r==="fire"?o===s?"편재":"정재":r==="wood"&&n==="earth"||r==="fire"&&n==="metal"||r==="earth"&&n==="water"||r==="metal"&&n==="wood"||r==="water"&&n==="fire"?o===s?"편관":"정관":""}function Gt(e,t){const n=Yt[e];if(n==null)return"";const r=H.indexOf(t);if(r<0)return"";const o=q[e]?1:-1,s=A((r-n)*o,12);return Pt[s]||""}function Ut(e,t){const n=Lt[e];return n&&n[t]||""}function zt(e,t,n){if(!n||!n.useLocalSolar)return{hour:e,minute:t};const r=typeof n.longitude=="number"?n.longitude:126.9784,o=Math.round((135-r)*4);let s=e*60+t-o;return s=A(s,1440),{hour:Math.floor(s/60),minute:s%60}}function Jt(e,t,n){let r=e;(t===1||t===2&&n<4)&&(r=e-1);const s=r-1984;return{stem:I[A(s,10)],branch:H[A(s,12)]}}function Wt(e,t,n,r){let o;t===2&&n>=4||t===3&&n<5?o=2:t===3&&n>=5||t===4&&n<4?o=3:t===4&&n>=4||t===5&&n<5?o=4:t===5&&n>=5||t===6&&n<5?o=5:t===6&&n>=5||t===7&&n<7?o=6:t===7&&n>=7||t===8&&n<7?o=7:t===8&&n>=7||t===9&&n<7?o=8:t===9&&n>=7||t===10&&n<8?o=9:t===10&&n>=8||t===11&&n<7?o=10:t===11&&n>=7||t===12&&n<7?o=11:t===12&&n>=7||t===1&&n<5?o=0:o=1;const s=I.indexOf(r);let i;s===0||s===5?i=2:s===1||s===6?i=4:s===2||s===7?i=6:s===3||s===8?i=8:i=0;const l=A(i+A(o-2,12),10);return{stem:I[l],branch:H[o]}}function qt(e,t,n,r=0,o=0){let s=ot(e,t,n);r*60+o>=1410&&(s+=1);const i=ot(1912,2,18),l=s-i;return{stem:I[A(l,10)],branch:H[A(l,12)]}}function Vt(e,t=0,n=0){const r=t*60+n,o=A(r-1410,1440),s=Math.floor(o/120),i=H[A(s,12)],l=I.indexOf(e);let m;return l===0||l===5?m=0:l===1||l===6?m=2:l===2||l===7?m=4:l===3||l===8?m=6:m=8,{stem:I[A(m+s,10)],branch:i}}function Xt(e,t,n){const r=[[1,5,"소한"],[1,20,"대한"],[2,4,"입춘"],[2,19,"우수"],[3,6,"경칩"],[3,21,"춘분"],[4,5,"청명"],[4,20,"곡우"],[5,6,"입하"],[5,21,"소만"],[6,6,"망종"],[6,21,"하지"],[7,7,"소서"],[7,23,"대서"],[8,7,"입추"],[8,23,"처서"],[9,7,"백로"],[9,23,"추분"],[10,8,"한로"],[10,23,"상강"],[11,7,"입동"],[11,22,"소설"],[12,7,"대설"],[12,22,"동지"]],o=new Date(e,t-1,n);let s=r[0][2];for(const[i,l,m]of r){const u=new Date(e,i-1,l);o>=u&&(s=m)}return{name:s}}function Le(e,t,n,r=0,o=0,s={}){const{hour:i,minute:l}=zt(r,o,s),m=Jt(e,t,n),u=Wt(e,t,n,m.stem),d=qt(e,t,n,i,l),a=Vt(d.stem,i,l),f=Xt(e,t,n),h=p=>{const b=Ft[p.branch]||[],y=Bt[p.branch]||b[0];return{...p,tenGodStem:it(d.stem,p.stem),tenGodBranch:y?it(d.stem,y):"",hiddenStems:b,lifeStage:Gt(d.stem,p.branch),shinsal:Ut(d.branch,p.branch)||"",elemStem:W[p.stem],elemBranch:Ht[p.branch]}};return{year:h(m),month:h(u),day:h(d),hour:h(a),season:f}}const Qt={甲:"목",乙:"목",丙:"화",丁:"화",戊:"토",己:"토",庚:"금",辛:"금",壬:"수",癸:"수"},Zt={子:"수",丑:"토",寅:"목",卯:"목",辰:"토",巳:"화",午:"화",未:"토",申:"금",酉:"금",戌:"토",亥:"수"},Kt={子:[{stem:"壬",w:1}],丑:[{stem:"己",w:.5},{stem:"癸",w:.3},{stem:"辛",w:.2}],寅:[{stem:"甲",w:.6},{stem:"丙",w:.3},{stem:"戊",w:.1}],卯:[{stem:"乙",w:1}],辰:[{stem:"戊",w:.5},{stem:"乙",w:.3},{stem:"癸",w:.2}],巳:[{stem:"丙",w:.6},{stem:"庚",w:.3},{stem:"戊",w:.1}],午:[{stem:"丁",w:.7},{stem:"己",w:.3}],未:[{stem:"己",w:.5},{stem:"丁",w:.3},{stem:"乙",w:.2}],申:[{stem:"庚",w:.7},{stem:"壬",w:.2},{stem:"戊",w:.1}],酉:[{stem:"辛",w:1}],戌:[{stem:"戊",w:.6},{stem:"辛",w:.3},{stem:"丁",w:.1}],亥:[{stem:"壬",w:.7},{stem:"甲",w:.3}]},te=[["子","午"],["丑","未"],["寅","申"],["卯","酉"],["辰","戌"],["巳","亥"]],ct=[["子","未"],["丑","午"],["寅","巳"],["卯","辰"],["申","亥"],["酉","戌"]],ee=[["子","卯"],["丑","戌"],["寅","亥"],["卯","子"],["辰","丑"],["巳","申"],["午","酉"],["未","辰"],["申","巳"],["酉","午"],["戌","未"],["亥","寅"]],ne=[["寅","巳","申"],["丑","戌","未"]],re=["辰","午","酉","子"],oe=[{set:["亥","卯","未"],element:"목"},{set:["寅","午","戌"],element:"화"},{set:["巳","酉","丑"],element:"금"},{set:["申","子","辰"],element:"수"}],se=[{set:["亥","子","丑"],element:"수"},{set:["寅","卯","辰"],element:"목"},{set:["巳","午","未"],element:"화"},{set:["申","酉","戌"],element:"금"}],g=["목","화","토","금","수"],ht=(e,t)=>g[(g.indexOf(e)+1)%5]===t,ae=(e,t)=>ht(t,e),pt=(e,t)=>g[(g.indexOf(e)+2)%5]===t,ie=(e,t)=>pt(t,e),Z=e=>(e??"").toString().trim(),D=e=>Qt[Z(e)]||null,gt=e=>Zt[Z(e)]||null,ce=e=>Array.from(new Set(e));function le(e,t={includeHidden:!0}){const n={목:0,화:0,토:0,금:0,수:0},r=(s,i=1)=>{n[s]!=null&&(n[s]+=i)},o=[e?.year,e?.month,e?.day,e?.hour].filter(Boolean);return o.forEach(s=>{const i=D(s.stem);i&&r(i,1)}),o.forEach(s=>{const i=gt(s.branch);i&&r(i,.8)}),t.includeHidden&&o.forEach(s=>{(Kt[Z(s.branch)]||[]).forEach(({stem:l,w:m})=>{const u=D(l);u&&r(u,m*.5)})}),n}function de(e){const t=D(e?.day?.stem);if(!t)return{score:0,level:"불명",rationale:"일간 미확인"};const n=le(e,{includeHidden:!0}),r=n[t]||0,o=g[(g.indexOf(t)+4)%5],s=g[(g.indexOf(t)+1)%5],i=g[(g.indexOf(t)+2)%5],l=g[(g.indexOf(t)+3)%5],m=n[o]||0,u=n[s]||0,d=n[i]||0,a=n[l]||0,f=e?.month?.branch,h=["寅","卯","辰"].includes(f)?"봄":["巳","午","未"].includes(f)?"여름":["申","酉","戌"].includes(f)?"가을":"겨울",b={봄:"목",여름:"화",가을:"금",겨울:"수"}[h]===t?.4:0,y=r*1+m*.7+u*.2+b-d*.6-a*.3;let v="중간";y>=2.8?v="신강":y<=1.8&&(v="신약");const N=`일간(${t}) 동류=${r.toFixed(1)}, 인성=${m.toFixed(1)}, 식상=${u.toFixed(1)}, 관살=${d.toFixed(1)}, 재성=${a.toFixed(1)}, 계절보정=${b.toFixed(1)} → 점수=${y.toFixed(2)}`;return{score:y,level:v,rationale:N,counts:n,monthGroup:h}}function ue(e){const t=ce([e?.year?.branch,e?.month?.branch,e?.day?.branch,e?.hour?.branch].filter(Boolean)),n=(a,f)=>t.includes(a)&&t.includes(f),r=a=>a.every(f=>t.includes(f)),o=oe.filter(a=>r(a.set)).map(a=>({type:"삼합",set:a.set,element:a.element})),s=se.filter(a=>r(a.set)).map(a=>({type:"방합",set:a.set,element:a.element})),i=te.filter(([a,f])=>n(a,f)).map(([a,f])=>({type:"충",pair:[a,f]})),l=ct.filter(([a,f])=>n(a,f)).map(([a,f])=>({type:"해",pair:[a,f]})),m=ee.filter(([a,f])=>n(a,f)).map(([a,f])=>({type:"파",pair:[a,f]})),u=[];ne.forEach(a=>{r(a)&&u.push({type:"형(삼형)",set:a})}),re.forEach(a=>{t.filter(h=>h===a).length>=2&&u.push({type:"형(자형)",pair:[a,a]})});const d=ct.filter(([a,f])=>n(a,f)).map(([a,f])=>({type:"원진",pair:[a,f]}));return{samhap:o,banghap:s,chong:i,hae:l,pa:m,hyeong:u,wonjin:d}}function fe(e){const t=D(e?.day?.stem),n=gt(e?.month?.branch);if(!t||!n)return{type:"불명",basis:"일간/월지 확인 불가"};let r="잡격";return n===t?r="비견격":ae(t,n)?r="인수격":ht(t,n)?r="식상격":ie(t,n)?r="관살격":pt(t,n)&&(r="재격"),{type:r,basis:`월지(${e?.month?.branch}:${n}) vs 일간(${t}) 관계`}}function me(e,t){const n=D(e?.day?.stem);if(!n)return{flow:[],temperature:[],notes:[]};const r=e?.month?.branch,o=["寅","卯","辰"].includes(r)?"봄":["巳","午","未"].includes(r)?"여름":["申","酉","戌"].includes(r)?"가을":"겨울",s=g[(g.indexOf(n)+4)%5],i=g[(g.indexOf(n)+2)%5],l=g[(g.indexOf(n)+3)%5],m=t?.level==="신약"?[n,s]:t?.level==="신강"?[i,l]:[n,i],u=o==="겨울"?["화"]:o==="여름"?["수"]:o==="봄"?["금","수"]:["목","수"],d=[`계절=${o}, 일간=${n}, 신강도=${t?.level||"불명"}`,`순환용신(휴리스틱)=${m.join(", ")}`,`조후용신(근사)=${u.join(", ")}`];return{flow:m,temperature:u,notes:d}}const he=new Set(["甲","丙","戊","庚","壬"]);function pe(e){return he.has(e)}function ge(e,t){const n=Q.indexOf(e),r=X.indexOf(t);if(n<0||r<0)return-1;for(let o=0;o<60;o++)if(o%10===n&&o%12===r)return o;return-1}function ye(e){const t=e%60%10,n=e%60%12;return{stem:Q[t],branch:X[n]}}const xe=["소한","입춘","경칩","청명","입하","망종","소서","입추","백로","한로","입동","대설"];function U(e){const t={};Mt.forEach(r=>{t[r.name]={month:r.month,day:r.approxDay}});const n=[];for(const r of xe){const o=t[r];o&&n.push({name:r,date:new Date(e,o.month-1,o.day,0,0,0)})}return n}function be(e,t){return(t-e)/(1e3*60*60*24)}function we(e,t){if(!e?.month||!e?.year)return{direction:"불명",start:{years:0,months:0,days:0},list:[]};const n=new Date(t.y,(t.m||1)-1,t.d,t.hh||0,t.mm||0,0),r=t.gender!=="female",o=t.yearStem||e.year.stem,s=pe(o),i=r&&s||!r&&!s,l=i?"순행":"역행",m=i?1:-1,u=n.getFullYear(),d=U(u),a=U(u+1),f=U(u-1);let h=null;if(i)h=[...d,...a].map(w=>w.date).find(w=>w.getTime()>n.getTime())||a[0]?.date;else{const x=[...f,...d].map(w=>w.date).filter(w=>w.getTime()<n.getTime());h=x[x.length-1]||f[f.length-1]?.date}h||(h=new Date(u,n.getMonth(),n.getDate()+5));const p=Math.max(0,Math.round(be(n,h))),b=p*4,y=Math.floor(b/12),v=b%12,N=ge(e.month.stem,e.month.branch),F=[],G=8;for(let x=1;x<=G;x++){const w=(N+m*x+60)%60,R=ye(w),T=y+(x-1)*10,_=T+9;F.push({order:x,pillar:R,ageStart:T,ageEnd:_})}let B=null;try{const x=new Date(n.getTime()),w=x.getFullYear(),R=x.getMonth(),T=x.getDate(),_=new Date(w,R+b,T);B=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`}catch{}return{direction:l,start:{years:y,months:v,days:p},startDate:B,list:F}}const ve=["갑","을","병","정","무","기","경","신","임","계"],Se=["자","축","인","묘","진","사","오","미","신","유","술","해"];function z(e){let t=(e-1984)%60;return t<0&&(t+=60),t}function lt(e){return{stem:ve[e%10],branch:Se[e%12]}}function dt(e){const t=e%60%10,n=e%60%12;return{stem:Q[t],branch:X[n]}}function je(e=new Date().getFullYear(),t=10){const n=[];for(let r=0;r<t;r++){const o=e+r,s=z(o);n.push({year:o,pillarKor:lt(s),pillarHan:dt(s)})}return{currentYear:e,currentKor:lt(z(e)),currentHan:dt(z(e)),list:n}}function Ge(e,t={}){const n=de(e),r=ue(e),o=fe(e),s=me(e,n);let i=null;t.birth&&t.birth.y&&(i=we(e,t.birth));const l=new Date().getFullYear(),m=je(l,10);return{counts:n.counts,strength:{score:Number(n.score?.toFixed?.(2)??n.score),level:n.level,rationale:n.rationale,monthGroup:n.monthGroup},relations:r,geoguk:o,yongshin:s,daewoon:i,sewoon:m}}function Ue(e){return D(e)}const yt=typeof navigator<"u"&&typeof navigator.vibrate=="function";function xt(){try{const e=navigator.userActivation;return!!(e?.isActive||e?.hasBeenActive)}catch{return!1}}function K(e=20){if(!yt||!xt())return!1;try{return navigator.vibrate(e)?!0:Array.isArray(e)?navigator.vibrate(20)||!1:navigator.vibrate([20,35,20])||!1}catch{return!1}}function bt(){if(yt&&xt())try{navigator.vibrate(0)}catch{}}function Ee(){K(20)}function ut(){bt(),K(30)}function ft(){bt(),K([25,40,25])}const wt=!1,Ae="https://cool-shape-9570.idcode1690.workers.dev",Ne=typeof location<"u"&&/github\.io|workers\.dev|vercel\.app|netlify\.app|unse\.news/i.test(location.host),V=wt&&!Ne?"/api/ai":`${Ae}/chat`;try{console.info("[openaiService] endpoint:",V,"mode=","production","dev=",wt)}catch{}const vt="ai_cache_v1:",L=new Map,tt=60*1e3,St=60*tt,$=24*St;function jt(){return Date.now()+9*St}function ke(){const e=jt(),t=$-e%$;return t>0?t:tt}function _e(){const e=jt(),n=new Date(e).getUTCDay(),r=e-e%$,o=(7-n)%7,i=r+(o===0?7:o)*$-e;return i>0?i:tt}function Et(e){const t=String(e||"").toUpperCase();return t.includes("TODAY")?ke():t.includes("SAJU")?365*$:t.includes("COMPAT")?30*$:t.includes("LOTTO")?_e():30*$}function Me(e){try{return localStorage.getItem(e)}catch{return null}}function $e(e,t){try{localStorage.setItem(e,t)}catch{}}function mt(e){try{localStorage.removeItem(e)}catch{}}function Te(e){if(!e)return null;const t=vt+e,n=Me(t);if(!n)return null;try{const{value:r,expireAt:o}=JSON.parse(n);return o&&Date.now()<o?String(r??""):(mt(t),null)}catch{return mt(t),null}}function Oe(e,t,n){if(!e)return;const r=vt+e,o=Date.now()+(n??Et(e));$e(r,JSON.stringify({value:String(t??""),expireAt:o}))}async function ze({messages:e,cacheKey:t,model:n="gpt-5.1-mini",temperature:r=.1,top_p:o=1,max_tokens:s=1800,seed:i=777}={}){const l=t?Te(t):null;if(l!=null&&l!==""){try{console.debug("[openaiService] cache HIT:",t)}catch{}return l}if(t&&L.has(t)){try{console.debug("[openaiService] inflight dedupe:",t)}catch{}return L.get(t)}const m={model:n,messages:e,cacheKey:t,temperature:r,top_p:o,max_tokens:s,seed:i},u=async a=>{const f=await fetch(a,{method:"POST",mode:"cors",credentials:"omit",cache:"no-store",headers:{"content-type":"text/plain;charset=UTF-8"},body:JSON.stringify(m),redirect:"follow",referrerPolicy:"no-referrer"}),h=await f.text();if(!f.ok){let v;try{v=JSON.parse(h)}catch{v={error:h}}const N=v?.error?.message||v?.error||h||"Unknown error";throw new Error(`OpenAI API 오류 (${f.status}): ${typeof N=="string"?N:JSON.stringify(N)}`)}let p;try{p=JSON.parse(h)}catch{p=null}const b=p?.choices?.[0]?.message?.content??(p?"":h),y=String(b??"");return t&&y&&Oe(t,y,Et(t)),y};try{Ee()}catch{}const d=(async()=>{try{const a=await u(V);try{ut()}catch{}return a}catch(a){if((a?.name==="TypeError"||/Failed to fetch/i.test(String(a?.message||"")))&&V!=="/api/ai")try{console.warn("[openaiService] primary failed, fallback -> /api/ai",a);const h=await u("/api/ai");try{ut()}catch{}return h}catch(h){try{ft()}catch{}throw h}try{ft()}catch{}throw a}})();t&&L.set(t,d);try{return await d}finally{t&&L.delete(t)}}const Ie={},J="운세뉴스",De=Ie?.VITE_SITE_URL&&String(void 0)||(typeof window<"u"?window.location.origin:"https://idcode1690.github.io/unse");function j(e,t){const n=Object.entries(t).map(([o,s])=>`[${o}="${s}"]`).join("");let r=document.head.querySelector(`${e}${n}`);return r||(r=document.createElement(e),Object.entries(t).forEach(([o,s])=>r.setAttribute(o,s)),document.head.appendChild(r)),r}function Re(e){return!e||!e.trim()?J:e.includes(J)?e:`${e} | ${J}`}function Je({title:e,description:t,path:n="/",image:r="/og-image.png",noIndex:o=!1}){const s=`${De}${n.startsWith("#")||n.startsWith("/")?n:`/${n}`}`,i=Re(e);document.title=i,t&&j("meta",{name:"description"}).setAttribute("content",t),j("meta",{name:"robots"}).setAttribute("content",o?"noindex,nofollow":"index,follow"),j("link",{rel:"canonical"}).setAttribute("href",s),j("meta",{property:"og:title"}).setAttribute("content",i),j("meta",{property:"og:description"}).setAttribute("content",t||""),j("meta",{property:"og:type"}).setAttribute("content","website"),j("meta",{property:"og:url"}).setAttribute("content",s),j("meta",{property:"og:image"}).setAttribute("content",r),j("meta",{name:"twitter:card"}).setAttribute("content","summary_large_image"),j("meta",{name:"twitter:title"}).setAttribute("content",i),j("meta",{name:"twitter:description"}).setAttribute("content",t||""),j("meta",{name:"twitter:image"}).setAttribute("content",r)}var Ce=Nt();function We({isOpen:e,onClose:t,pageTitle:n="운세뉴스",shareText:r="유용했다면 지인에게 공유해보세요!"}){const o=O.useRef(null),s=O.useRef(null),i=O.useRef(null),l=O.useRef(null),m=O.useRef(""),u=()=>{const{origin:E,pathname:S}=window.location;return`${E}${S}#/`},d=()=>{try{t?.()}catch{}},a=E=>{E.target===o.current&&d()},f=()=>{try{window.location.hash="#/"}finally{d()}},h=async()=>{const E=u();if(navigator.share){try{await navigator.share({title:n,text:r,url:E})}catch{}f();return}try{await navigator.clipboard.writeText(E),alert("홈 링크를 클립보드에 복사했습니다.")}catch{try{const S=document.createElement("textarea");S.value=E,S.setAttribute("readonly",""),S.style.position="fixed",S.style.opacity="0",document.body.appendChild(S),S.select(),document.execCommand("copy"),document.body.removeChild(S),alert("홈 링크를 클립보드에 복사했습니다.")}catch{}}finally{f()}};if(O.useEffect(()=>{if(!e)return;try{document.body.classList.remove("scroll-lock")}catch{}m.current=document.body.style.overflow||"",document.body.style.overflow="hidden",l.current=document.activeElement;const E=setTimeout(()=>(i.current||s.current)?.focus(),0),S=k=>{if(k.key==="Escape"&&(k.preventDefault(),d()),k.key==="Tab"){const P=He(s.current);if(!P.length){k.preventDefault(),s.current?.focus();return}const nt=P[0],rt=P[P.length-1];k.shiftKey&&document.activeElement===nt?(k.preventDefault(),rt.focus()):!k.shiftKey&&document.activeElement===rt&&(k.preventDefault(),nt.focus())}};return window.addEventListener("keydown",S),()=>{clearTimeout(E),window.removeEventListener("keydown",S),document.body.style.overflow=m.current||"";try{l.current?.focus?.()}catch{}}},[e]),!e)return null;const p=(()=>{try{return window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch{return!1}})(),b={position:"fixed",inset:0,zIndex:1e3,background:"color-mix(in oklab, black 38%, transparent)",display:"grid",placeItems:"center",padding:16,backdropFilter:"blur(2px)",animation:p?void 0:"fadeIn .16s ease-out"},y={width:"min(560px, 94vw)",background:"var(--surface, #fff)",color:"var(--ink, #111827)",border:"1px solid var(--border, #e5e7eb)",borderRadius:16,boxShadow:"0 20px 48px rgba(0,0,0,.16)",overflow:"hidden",outline:"none",display:"grid",gridTemplateRows:"auto 1fr auto",transform:p?"none":"translateY(6px)",animation:p?void 0:"popIn .18s ease-out"},v={padding:"16px 18px 12px",borderBottom:"1px solid var(--border, #e5e7eb)",display:"flex",alignItems:"center",gap:12},N={width:36,height:36,flex:"0 0 36px",display:"grid",placeItems:"center",borderRadius:12,color:"#fff",background:"linear-gradient(135deg, var(--accent, #7a5af8), #0fa958)",boxShadow:"0 6px 20px rgba(122,90,248,.25)",fontSize:18,fontWeight:800},F={display:"grid",gap:4},G={margin:0,fontSize:18,fontWeight:800,lineHeight:1.25},B={margin:0,fontSize:13,color:"var(--ink-soft, #6b7280)"},x={padding:18,display:"grid",gap:12},w={padding:12,border:"1px solid var(--border, #e5e7eb)",borderRadius:12,background:"var(--surface, #fff)",fontSize:14,color:"var(--ink, #374151)",lineHeight:1.6},R={display:"flex",alignItems:"center",gap:8,padding:10,borderRadius:10,border:"1px dashed var(--border, #e5e7eb)",background:"color-mix(in oklab, var(--surface, #fff) 92%, #7a5af8 8%)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',overflow:"hidden"},T={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:13,opacity:.9},_={padding:14,borderTop:"1px solid var(--border, #e5e7eb)",display:"flex",justifyContent:"flex-end",gap:8,background:"var(--surface, #fff)"},et=u(),At=c.jsxs("div",{ref:o,style:b,onClick:a,"data-testid":"share-backdrop",children:[c.jsxs("div",{ref:s,role:"dialog","aria-modal":"true","aria-labelledby":"share-title","aria-describedby":"share-desc",style:y,tabIndex:-1,onClick:E=>E.stopPropagation(),"data-testid":"share-modal",children:[c.jsxs("div",{style:v,children:[c.jsx("div",{style:N,"aria-hidden":!0,children:"🔗"}),c.jsxs("div",{style:F,children:[c.jsx("h3",{id:"share-title",style:G,children:"공유하기"}),c.jsx("p",{style:B,children:"친구/가족에게 운세뉴스를 알려보세요"})]})]}),c.jsxs("div",{style:x,children:[c.jsxs("div",{id:"share-desc",style:w,children:[c.jsx("strong",{style:{fontWeight:800},children:n}),c.jsx("div",{style:{marginTop:6},children:r})]}),c.jsxs("div",{style:R,"aria-label":"공유 링크",children:[c.jsx("span",{style:{opacity:.6},children:"URL"}),c.jsx("span",{style:T,title:et,children:et})]})]}),c.jsxs("div",{style:_,children:[c.jsx(st,{variant:"text",onClick:d,ref:i,"data-testid":"share-cancel",children:"다음에"}),c.jsx(st,{onClick:h,"data-testid":"share-confirm",children:"공유하기"})]})]}),c.jsx("style",{children:`
        @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
        @keyframes popIn {
          from { opacity: .001; transform: translateY(10px) scale(.98) }
          to   { opacity: 1;    transform: translateY(0)  scale(1) }
        }
        @media (prefers-reduced-motion: reduce){
          @keyframes fadeIn { from { opacity: 1 } to { opacity: 1 } }
          @keyframes popIn  { from { transform:none } to { transform:none } }
        }
      `})]});return Ce.createPortal(At,document.body)}function He(e){if(!e)return[];const t=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(",");return Array.from(e.querySelectorAll(t)).filter(n=>{const r=window.getComputedStyle(n);return r.display!=="none"&&r.visibility!=="hidden"})}export{Ye as A,Pe as P,We as S,Ge as a,ze as b,Le as c,le as d,Ue as g,de as i,Je as s};

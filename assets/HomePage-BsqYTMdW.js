import{r as l,j as a}from"./index-Ba2vumV5.js";import{l as ie,D as b,a as S,s as ue,M as de,b as me,c as he,C as q,S as z,d as C,B as G}from"./index-DCrhh5Dy.js";const j="home_form_locked_v1",E="home_allow_scroll_once";function pe(n){return n=Number(n),!Number.isFinite(n)||n<=0?!1:n%400===0||n%4===0&&n%100!==0}function L(n,d){const T=Number(n),r=Number(d);return!Number.isFinite(r)||r<1||r>12?31:r===2?pe(T)?29:28:[4,6,9,11].includes(r)?30:31}function K(n){try{return localStorage.getItem(n)}catch{return null}}function H(n,d){try{localStorage.setItem(n,d)}catch{}}function $(n){try{return sessionStorage.getItem(n)}catch{return null}}function R(n,d){try{sessionStorage.setItem(n,d)}catch{}}function fe(n){try{sessionStorage.removeItem(n)}catch{}}const ge=["","자","축","인","묘","진","사","오","미","신","유","술","해"],ve=()=>{const[n,d]=l.useState(()=>{const e=ie();if(e)return{...b,hourBranch:e.hourBranch||"",hour:e.hour||"",...e};const t=S();if(t){const{calendar:o,year:s,month:u,day:f,hour:g,hourBranch:p,gender:c,leapMonth:m,mbti:i}=t;return{...b,calendar:o??b.calendar,year:s??"",month:u??"",day:f??"",hour:g??"",hourBranch:p||"",gender:c??b.gender,leapMonth:m??b.leapMonth,mbti:i??""}}return{...b,hourBranch:""}}),T=()=>{const e=K(j);return e==="1"?!0:e==="0"?!1:!!S()},[r,N]=l.useState(T),[B,D]=l.useState(()=>!!S()),O=l.useRef(null);l.useEffect(()=>{if(K(j)===null){const t=!!S();H(j,t?"1":"0"),t&&!r&&N(!0)}$(E)===null&&R(E,"0")},[]);const F=l.useRef(!0);l.useEffect(()=>{if(F.current){F.current=!1;return}ue(n)},[n]);const W=l.useMemo(()=>{const e=[];for(let t=1900;t<=2029;t++)e.push({value:String(t),label:`${t}년`});return e},[]),P=l.useMemo(()=>Array.from({length:12},(e,t)=>({value:String(t+1),label:`${t+1}월`})),[]),U=l.useMemo(()=>{const t=n.calendar==="lunar"?30:L(n.year,n.month);return Array.from({length:t},(o,s)=>({value:String(s+1),label:`${s+1}일`}))},[n.calendar,n.year,n.month]),Q=l.useMemo(()=>ge.map(e=>({value:e,label:e===""?"모름":`${e}시`})),[]),_=l.useMemo(()=>de.map(e=>({value:e.value,label:e.label})),[]),I=l.useCallback(e=>{const t={...e},s=t.calendar==="lunar"?30:L(t.year,t.month),u=Number(t.day);return(!u||u>s)&&(t.day=String(Math.min(u||1,s))),t},[]);l.useEffect(()=>{const t=n.calendar==="lunar"?30:L(n.year,n.month),o=Number(n.day);o&&o>t&&d(s=>({...s,day:String(t)}))},[n.calendar,n.year,n.month]);const V=e=>{r||d(t=>I({...t,calendar:e}))},J=e=>{r||d(t=>({...t,gender:e}))},x=(e,t)=>{r||d(e==="year"||e==="month"||e==="leapMonth"?o=>I({...o,[e]:t}):o=>({...o,[e]:t}))},X=e=>{if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const o=getComputedStyle(t),s=o.overflowY||o.overflow;if(/(auto|scroll|overlay)/i.test(s))return t;t=t.parentElement}return null},w=l.useCallback(()=>{try{const e=document.querySelector('header, .header, [role="banner"]');if(!e)return 0;const t=(getComputedStyle(e)?.position||"").toLowerCase();return t.includes("fixed")||t.includes("sticky")?Math.ceil(e.getBoundingClientRect().height||0):0}catch{return 0}},[]),M=l.useRef(0),h=l.useCallback(()=>{M.current&&(cancelAnimationFrame(M.current),M.current=0);try{const e=document.documentElement;e&&(e.style.scrollBehavior="")}catch{}},[]);l.useEffect(()=>{const e=["wheel","touchstart","keydown","mousedown"];return e.forEach(t=>window.addEventListener(t,h,{passive:!0})),()=>e.forEach(t=>window.removeEventListener(t,h))},[h]);const Z=e=>1-Math.pow(1-e,5),y=l.useCallback((e,t,o=1400)=>{h();const s=!e,u=document.scrollingElement||document.documentElement,f=s?u.scrollTop||window.pageYOffset||0:e.scrollTop,g=t-f;if(Math.abs(g)<1)return;let p=0;const c=document.documentElement,m=c?c.style.scrollBehavior:"";c&&(c.style.scrollBehavior="auto");const i=v=>{p||(p=v);const re=v-p,A=Math.min(1,re/o),ce=Z(A),Y=f+g*ce;s?window.scrollTo(0,Y):e.scrollTop=Y,A<1?M.current=requestAnimationFrame(i):(setTimeout(()=>{c&&(c.style.scrollBehavior=m||"")},10),M.current=0)};M.current=requestAnimationFrame(i)},[h]),k=l.useCallback(()=>{const e=O.current;if(!e)return;const t=X(e),o=w(),s=Math.max(14,Math.min(40,Math.round((window.innerHeight||600)*.04)));if(t){const u=t.getBoundingClientRect(),f=e.getBoundingClientRect(),g=t.scrollTop+(f.top-u.top)-o-s,p=Math.max(0,Math.min(g,t.scrollHeight-t.clientHeight));y(t,p,1400),setTimeout(()=>{const c=t.getBoundingClientRect(),m=e.getBoundingClientRect(),i=Math.max(0,Math.min(t.scrollTop+(m.top-c.top)-w()-s,t.scrollHeight-t.clientHeight));Math.abs(i-t.scrollTop)>20&&y(t,i,600)},350),setTimeout(()=>{const c=t.getBoundingClientRect(),m=e.getBoundingClientRect(),i=Math.max(0,Math.min(t.scrollTop+(m.top-c.top)-w()-s,t.scrollHeight-t.clientHeight));Math.abs(i-t.scrollTop)>20&&y(t,i,500)},800)}else{const u=document.scrollingElement||document.documentElement,f=e.getBoundingClientRect(),g=(u.scrollTop||window.pageYOffset||0)+f.top-o-s,p=Math.max(0,u.scrollHeight-(window.innerHeight||u.clientHeight)),c=Math.max(0,Math.min(g,p));y(null,c,1400),setTimeout(()=>{const m=e.getBoundingClientRect(),i=(document.scrollingElement||document.documentElement).scrollTop+m.top-w()-s,v=Math.max(0,Math.min(i,(document.scrollingElement||document.documentElement).scrollHeight-(window.innerHeight||(document.scrollingElement||document.documentElement).clientHeight)));Math.abs(v-(document.scrollingElement||document.documentElement).scrollTop)>20&&y(null,v,600)},350),setTimeout(()=>{const m=e.getBoundingClientRect(),i=(document.scrollingElement||document.documentElement).scrollTop+m.top-w()-s,v=Math.max(0,Math.min(i,(document.scrollingElement||document.documentElement).scrollHeight-(window.innerHeight||(document.scrollingElement||document.documentElement).clientHeight)));Math.abs(v-(document.scrollingElement||document.documentElement).scrollTop)>20&&y(null,v,500)},800)}},[w,y]),ee=l.useCallback(()=>{const e=!!(n.year&&n.month&&n.day),t=n.calendar==="solar"||!!n.leapMonth,o=!!n.gender;!e||!t||!o||(N(!0),H(j,"1"),me({calendar:n.calendar,year:n.year,month:n.month,day:n.day,hour:"",hourBranch:n.hourBranch||"",minute:"0",gender:n.gender,leapMonth:n.leapMonth,mbti:n.mbti||""}),R(E,"1"),D(!0))},[n]);l.useEffect(()=>!B||!($(E)==="1")?void 0:(requestAnimationFrame(()=>{k(),setTimeout(k,900),setTimeout(k,1500),R(E,"0")}),()=>h()),[B,k,h]);const te=l.useCallback(()=>{d({...b,hourBranch:""}),he(),N(!1),H(j,"0"),D(!1),fe(E),h()},[h]),ne=[{value:"solar",label:"양력"},{value:"lunar",label:"음력"}],ae=[{value:"male",label:"남성"},{value:"female",label:"여성"}],oe=[{value:"common",label:"평달"},{value:"leap",label:"윤달"}],le=n.calendar==="lunar",se=[{key:"result",icon:"📜",title:"사주팔자",desc:"정확한 사주 계산",href:"#/result"},{key:"fortune",icon:"🔮",title:"오늘의 운세",desc:"오늘 운세 한눈에",href:"#/fortune"},{key:"lotto",icon:"🎰",title:"로또운세",desc:"사주 기반 번호 추천",href:"#/lotto"},{key:"compat",icon:"❤️",title:"궁합",desc:"상대와의 궁합 확인",href:"#/compat"},{key:"ask",icon:"❓",title:"질문 풀이",desc:"사주로 궁금증 풀이",href:"#/ask"}];return a.jsxs("section",{className:"calculator",children:[a.jsxs(q,{className:"form-card",children:[a.jsx("h2",{className:"h2",style:{marginTop:0},children:"내 정보"}),a.jsxs("fieldset",{disabled:r,"aria-disabled":r,className:r?"fieldset-locked":void 0,style:{border:0,padding:0,margin:0},children:[a.jsxs("div",{className:"row cols-2",children:[a.jsx("div",{className:"field-calendar",children:a.jsx(z,{label:"달력",options:ne,value:n.calendar,onChange:V,ariaLabel:"달력 종류 선택",helper:"음력 선택 시 양력으로 자동 변환해 계산합니다."})}),le&&a.jsx("div",{className:"field-leap",children:a.jsx(C,{label:"윤달 여부",id:"leapMonth",options:oe,value:n.leapMonth,onChange:e=>x("leapMonth",e.target.value),helper:"음력에서만 의미가 있습니다."})})]}),a.jsxs("div",{className:"row cols-2",children:[a.jsx("div",{className:"field-gender",children:a.jsx(z,{label:"성별",options:ae,value:n.gender,onChange:J,ariaLabel:"성별 선택",helper:a.jsxs("span",{children:["성별은 ",a.jsx("strong",{children:"대운 방향(순/역행)"})," 계산에 사용됩니다."]})})}),a.jsx("div",{className:"field-mbti only-desktop",children:a.jsx(C,{label:"MBTI (선택사항)",id:"mbti-desktop",options:_,value:n.mbti||"",onChange:e=>x("mbti",e.target.value),helper:"더 개인화된 해석을 위해 선택해주세요"})})]}),a.jsxs("div",{className:"row cols-4 sm-cols-2","aria-label":"생년월일 및 시간 선택",children:[a.jsx("div",{className:"field-year",children:a.jsx(C,{label:"년도",id:"year",options:W,value:n.year,onChange:e=>x("year",e.target.value)})}),a.jsx("div",{className:"field-month",children:a.jsx(C,{label:"월",id:"month",options:P,value:n.month,onChange:e=>x("month",e.target.value)})}),a.jsx("div",{className:"field-day",children:a.jsx(C,{label:"일",id:"day",options:U,value:n.day,onChange:e=>x("day",e.target.value)})}),a.jsx("div",{className:"field-hour",children:a.jsx(C,{label:"시간",id:"hourBranch",options:Q,value:n.hourBranch||"",onChange:e=>x("hourBranch",e.target.value),helper:"지지 기준 시간(자‧축‧…‧해), 모름 선택 가능"})})]}),a.jsx("div",{className:"row only-mobile",style:{marginTop:"clamp(8px, 2.2vw, 16px)"},children:a.jsx("div",{className:"field-mbti",children:a.jsx(C,{label:"MBTI (선택사항)",id:"mbti-mobile",options:_,value:n.mbti||"",onChange:e=>x("mbti",e.target.value),helper:"더 개인화된 해석을 위해 선택해주세요"})})})]}),a.jsxs("div",{className:"actions",style:{marginTop:"clamp(10px, 2.8vw, 20px)",gap:10},children:[a.jsx(G,{variant:"text",onClick:te,children:"초기화"}),a.jsx(G,{onClick:ee,disabled:r,children:r?"저장완료":"정보저장"})]})]}),B&&a.jsx("div",{className:"row cols-4 gx quick-grid","aria-label":"빠른 메뉴",children:se.map((e,t)=>a.jsx(q,{ref:t===0?O:null,role:"link",tabIndex:0,className:"nav-card-simple",onClick:()=>window.location.hash=e.href,onKeyDown:o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),window.location.hash=e.href)},children:a.jsxs("div",{className:"nav-simple",children:[a.jsx("div",{className:"nav-icon","aria-hidden":!0,children:e.icon}),a.jsxs("div",{className:"nav-body",children:[a.jsx("h3",{className:"h3 nav-title",children:e.title}),a.jsx("p",{className:"muted nav-desc",children:e.desc})]})]})},e.key))}),a.jsx("style",{children:`
        .form-card { margin-bottom: 14px; }
        .quick-grid { margin-top: 10px; }

        /* ✅ 락된 필드셋: 커스텀 컴포넌트까지 클릭 차단 */
        .fieldset-locked { opacity: 0.98; }
        .fieldset-locked * {
          pointer-events: none !important;
          cursor: not-allowed !important;
        }

        /* ───────── 심플 카드 레이아웃 ───────── */
        .nav-card-simple { cursor: pointer; }
        .nav-simple{
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px;
        }
        .nav-icon{
          font-size: 24px;
          line-height: 1;
          flex-shrink: 0;
        }
        .nav-title{
          margin: 0;
          font-weight: 800;
          line-height: 1.22;
        }
        .nav-desc{
          margin: 2px 0 0;
          font-size: 13px;
          color: var(--ink-soft, #6b7280);
        }

        @media (max-width: 640px){
          .nav-title{ font-size: 18px; }
          .nav-desc{ font-size: 15px; margin-top: 0; }
        }
      `})]})},be=()=>{const n=()=>{navigator.vibrate&&navigator.vibrate(10)};return a.jsx("section",{className:"calculator",children:a.jsx(ve,{onSuccess:n})})};export{be as default};

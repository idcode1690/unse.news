import{r as o,j as a}from"./index-Cq4ejKLT.js";import{l as ie,D as b,a as k,s as de,d as A,M as ue,b as me,c as he,C as q,S as Y,e as C,B as z}from"./cookieUtils-CWdrEs-e.js";const E="home_form_locked_v1",j="home_allow_scroll_once";function G(n){try{return localStorage.getItem(n)}catch{return null}}function L(n,u){try{localStorage.setItem(n,u)}catch{}}function K(n){try{return sessionStorage.getItem(n)}catch{return null}}function B(n,u){try{sessionStorage.setItem(n,u)}catch{}}function ge(n){try{sessionStorage.removeItem(n)}catch{}}const pe=()=>{const[n,u]=o.useState(()=>{const e=ie();if(e)return{...b,...e};const t=k();if(t){const{calendar:l,year:s,month:c,day:p,hour:f,gender:g,leapMonth:r,mbti:d}=t;return{...b,calendar:l??b.calendar,year:s??"",month:c??"",day:p??"",hour:f??"",gender:g??b.gender,leapMonth:r??b.leapMonth,mbti:d??""}}return{...b}}),$=()=>{const e=G(E);return e==="1"?!0:e==="0"?!1:!!k()},[m,T]=o.useState($),[N,H]=o.useState(()=>!!k()),R=o.useRef(null);o.useEffect(()=>{if(G(E)===null){const t=!!k();L(E,t?"1":"0"),t&&!m&&T(!0)}K(j)===null&&B(j,"0")},[]);const O=o.useRef(!0);o.useEffect(()=>{if(O.current){O.current=!1;return}de(n)},[n]);const W=o.useMemo(()=>{const e=[];for(let t=1900;t<=2029;t++)e.push({value:String(t),label:`${t}년`});return e},[]),P=o.useMemo(()=>Array.from({length:12},(e,t)=>({value:String(t+1),label:`${t+1}월`})),[]),U=o.useMemo(()=>{const t=n.calendar==="lunar"?30:A(Number(n.year),Number(n.month));return Array.from({length:t},(l,s)=>({value:String(s+1),label:`${s+1}일`}))},[n.calendar,n.year,n.month]),Q=o.useMemo(()=>Array.from({length:24},(e,t)=>({value:String(t),label:`${t}시`})),[]),D=o.useMemo(()=>ue.map(e=>({value:e.value,label:e.label})),[]),_=o.useCallback(e=>{const t={...e},s=t.calendar==="lunar"?30:A(Number(t.year),Number(t.month)),c=Number(t.day);return(!c||c>s)&&(t.day=String(Math.min(c||1,s))),t},[]),V=e=>{m||u(t=>_({...t,calendar:e}))},J=e=>{m||u(t=>({...t,gender:e}))},x=(e,t)=>{m||u(e==="year"||e==="month"||e==="leapMonth"?l=>_({...l,[e]:t}):l=>({...l,[e]:t}))},X=e=>{if(!e||typeof window>"u")return null;let t=e.parentElement;for(;t;){const l=getComputedStyle(t),s=l.overflowY||l.overflow;if(/(auto|scroll|overlay)/i.test(s))return t;t=t.parentElement}return null},w=o.useCallback(()=>{try{const e=document.querySelector('header, .header, [role="banner"]');if(!e)return 0;const t=(getComputedStyle(e)?.position||"").toLowerCase();return t.includes("fixed")||t.includes("sticky")?Math.ceil(e.getBoundingClientRect().height||0):0}catch{return 0}},[]),M=o.useRef(0),h=o.useCallback(()=>{M.current&&(cancelAnimationFrame(M.current),M.current=0);try{const e=document.documentElement;e&&(e.style.scrollBehavior="")}catch{}},[]);o.useEffect(()=>{const e=["wheel","touchstart","keydown","mousedown"];return e.forEach(t=>window.addEventListener(t,h,{passive:!0})),()=>e.forEach(t=>window.removeEventListener(t,h))},[h]);const Z=e=>1-Math.pow(1-e,5),y=o.useCallback((e,t,l=1400)=>{h();const s=!e,c=document.scrollingElement||document.documentElement,p=s?c.scrollTop||window.pageYOffset||0:e.scrollTop,f=t-p;if(Math.abs(f)<1)return;let g=0;const r=document.documentElement,d=r?r.style.scrollBehavior:"";r&&(r.style.scrollBehavior="auto");const i=v=>{g||(g=v);const re=v-g,F=Math.min(1,re/l),ce=Z(F),I=p+f*ce;s?window.scrollTo(0,I):e.scrollTop=I,F<1?M.current=requestAnimationFrame(i):(setTimeout(()=>{r&&(r.style.scrollBehavior=d||"")},10),M.current=0)};M.current=requestAnimationFrame(i)},[h]),S=o.useCallback(()=>{const e=R.current;if(!e)return;const t=X(e),l=w(),s=Math.max(14,Math.min(40,Math.round((window.innerHeight||600)*.04)));if(t){const c=t.getBoundingClientRect(),p=e.getBoundingClientRect(),f=t.scrollTop+(p.top-c.top)-l-s,g=Math.max(0,Math.min(f,t.scrollHeight-t.clientHeight));y(t,g,1400),setTimeout(()=>{const r=t.getBoundingClientRect(),d=e.getBoundingClientRect(),i=Math.max(0,Math.min(t.scrollTop+(d.top-r.top)-w()-s,t.scrollHeight-t.clientHeight));Math.abs(i-t.scrollTop)>20&&y(t,i,600)},350),setTimeout(()=>{const r=t.getBoundingClientRect(),d=e.getBoundingClientRect(),i=Math.max(0,Math.min(t.scrollTop+(d.top-r.top)-w()-s,t.scrollHeight-t.clientHeight));Math.abs(i-t.scrollTop)>20&&y(t,i,500)},800)}else{const c=document.scrollingElement||document.documentElement,p=e.getBoundingClientRect(),f=(c.scrollTop||window.pageYOffset||0)+p.top-l-s,g=Math.max(0,c.scrollHeight-(window.innerHeight||c.clientHeight)),r=Math.max(0,Math.min(f,g));y(null,r,1400),setTimeout(()=>{const d=e.getBoundingClientRect(),i=(document.scrollingElement||document.documentElement).scrollTop+d.top-w()-s,v=Math.max(0,Math.min(i,(document.scrollingElement||document.documentElement).scrollHeight-(window.innerHeight||(document.scrollingElement||document.documentElement).clientHeight)));Math.abs(v-(document.scrollingElement||document.documentElement).scrollTop)>20&&y(null,v,600)},350),setTimeout(()=>{const d=e.getBoundingClientRect(),i=(document.scrollingElement||document.documentElement).scrollTop+d.top-w()-s,v=Math.max(0,Math.min(i,(document.scrollingElement||document.documentElement).scrollHeight-(window.innerHeight||(document.scrollingElement||document.documentElement).clientHeight)));Math.abs(v-(document.scrollingElement||document.documentElement).scrollTop)>20&&y(null,v,500)},800)}},[w,y]),ee=o.useCallback(()=>{const e=!!(n.year&&n.month&&n.day),t=n.calendar==="solar"||!!n.leapMonth,l=!!n.gender;!e||!t||!l||(T(!0),L(E,"1"),me({calendar:n.calendar,year:n.year,month:n.month,day:n.day,hour:n.hour||"0",minute:"0",gender:n.gender,leapMonth:n.leapMonth,mbti:n.mbti||""}),B(j,"1"),H(!0))},[n]);o.useEffect(()=>!N||!(K(j)==="1")?void 0:(requestAnimationFrame(()=>{S(),setTimeout(S,900),setTimeout(S,1500),B(j,"0")}),()=>h()),[N,S,h]);const te=o.useCallback(()=>{u({...b}),he(),T(!1),L(E,"0"),H(!1),ge(j),h()},[h]),ne=[{value:"solar",label:"양력"},{value:"lunar",label:"음력"}],ae=[{value:"male",label:"남성"},{value:"female",label:"여성"}],oe=[{value:"common",label:"평달"},{value:"leap",label:"윤달"}],le=n.calendar==="lunar",se=[{key:"result",icon:"📜",title:"사주팔자",desc:"정확한 사주 계산",href:"#/result"},{key:"fortune",icon:"🔮",title:"오늘의 운세",desc:"오늘 운세 한눈에",href:"#/fortune"},{key:"lotto",icon:"🎰",title:"로또 추천",desc:"사주 기반 번호 추천",href:"#/lotto"},{key:"compat",icon:"❤️",title:"궁합",desc:"상대와의 궁합 확인",href:"#/compat"}];return a.jsxs("section",{className:"calculator",children:[a.jsxs(q,{className:"form-card",children:[a.jsx("h2",{className:"h2",style:{marginTop:0},children:"내 정보"}),a.jsxs("fieldset",{disabled:m,"aria-disabled":m,className:m?"fieldset-locked":void 0,style:{border:0,padding:0,margin:0},children:[a.jsxs("div",{className:"row cols-2",children:[a.jsx("div",{className:"field-calendar",children:a.jsx(Y,{label:"달력",options:ne,value:n.calendar,onChange:V,ariaLabel:"달력 종류 선택",helper:"음력 선택 시 양력으로 자동 변환해 계산합니다."})}),le&&a.jsx("div",{className:"field-leap",children:a.jsx(C,{label:"윤달 여부",id:"leapMonth",options:oe,value:n.leapMonth,onChange:e=>x("leapMonth",e.target.value),helper:"음력에서만 의미가 있습니다."})})]}),a.jsxs("div",{className:"row cols-2",children:[a.jsx("div",{className:"field-gender",children:a.jsx(Y,{label:"성별",options:ae,value:n.gender,onChange:J,ariaLabel:"성별 선택",helper:a.jsxs("span",{children:["성별은 ",a.jsx("strong",{children:"대운 방향(순/역행)"})," 계산에 사용됩니다."]})})}),a.jsx("div",{className:"field-mbti only-desktop",children:a.jsx(C,{label:"MBTI (선택사항)",id:"mbti-desktop",options:D,value:n.mbti||"",onChange:e=>x("mbti",e.target.value),helper:"더 개인화된 해석을 위해 선택해주세요"})})]}),a.jsxs("div",{className:"row cols-4 sm-cols-2","aria-label":"생년월일 및 시간 선택",children:[a.jsx("div",{className:"field-year",children:a.jsx(C,{label:"년도",id:"year",options:W,value:n.year,onChange:e=>x("year",e.target.value)})}),a.jsx("div",{className:"field-month",children:a.jsx(C,{label:"월",id:"month",options:P,value:n.month,onChange:e=>x("month",e.target.value)})}),a.jsx("div",{className:"field-day",children:a.jsx(C,{label:"일",id:"day",options:U,value:n.day,onChange:e=>x("day",e.target.value)})}),a.jsx("div",{className:"field-hour",children:a.jsx(C,{label:"시간",id:"hour",options:Q,value:n.hour,onChange:e=>x("hour",e.target.value),helper:"대략적인 시간도 괜찮아요"})})]}),a.jsx("div",{className:"row only-mobile",style:{marginTop:"clamp(8px, 2.2vw, 16px)"},children:a.jsx("div",{className:"field-mbti",children:a.jsx(C,{label:"MBTI (선택사항)",id:"mbti-mobile",options:D,value:n.mbti||"",onChange:e=>x("mbti",e.target.value),helper:"더 개인화된 해석을 위해 선택해주세요"})})})]}),a.jsxs("div",{className:"actions",style:{marginTop:"clamp(10px, 2.8vw, 20px)",gap:10},children:[a.jsx(z,{variant:"text",onClick:te,children:"초기화"}),a.jsx(z,{onClick:ee,disabled:m,children:m?"저장완료":"정보저장"})]})]}),N&&a.jsx("div",{className:"row cols-4 gx quick-grid","aria-label":"빠른 메뉴",children:se.map((e,t)=>a.jsx(q,{ref:t===0?R:null,role:"link",tabIndex:0,className:"nav-card-simple",onClick:()=>window.location.hash=e.href,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),window.location.hash=e.href)},children:a.jsxs("div",{className:"nav-simple",children:[a.jsx("div",{className:"nav-icon","aria-hidden":!0,children:e.icon}),a.jsxs("div",{className:"nav-body",children:[a.jsx("h3",{className:"h3 nav-title",children:e.title}),a.jsx("p",{className:"muted nav-desc",children:e.desc})]})]})},e.key))}),a.jsx("style",{children:`
        .form-card { margin-bottom: 14px; }
        .quick-grid { margin-top: 10px; }

        /* ✅ 락된 필드셋: 커스텀 컴포넌트까지 클릭 차단 */
        .fieldset-locked { opacity: 0.98; }
        .fieldset-locked * {
          pointer-events: none !important;
          cursor: not-allowed !important;
        }

        /* ───────── 심플 카드 레이아웃 ───────── */
        .nav-card-simple { cursor: pointer; }
        .nav-simple{
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px;
        }
        .nav-icon{
          font-size: 24px;
          line-height: 1;
          flex-shrink: 0;
        }
        .nav-title{
          margin: 0;
          font-weight: 800;
          line-height: 1.22;
        }
        .nav-desc{
          margin: 2px 0 0;
          font-size: 13px;
          color: var(--ink-soft, #6b7280);
        }

        @media (max-width: 640px){
          .nav-title{ font-size: 18px; }
          .nav-desc{ font-size: 15px; margin-top: 0; }
        }
      `})]})},xe=()=>{const n=()=>{navigator.vibrate&&navigator.vibrate(10)};return a.jsx("section",{className:"calculator",children:a.jsx(pe,{onSuccess:n})})};export{xe as default};

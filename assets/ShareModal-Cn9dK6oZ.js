import{j as a,r as b,a as pe}from"./index-ydNJF_F3.js";import{F as me,E as he,t as U,B as G}from"./cookieUtils-ClIWEGg2.js";const ge={갑:"甲",을:"乙",병:"丙",정:"丁",무:"戊",기:"己",경:"庚",신:"辛",임:"壬",계:"癸"},be={자:"子",축:"丑",인:"寅",묘:"卯",진:"辰",사:"巳",오:"午",미:"未",신:"申",유:"酉",술:"戌",해:"亥"};function ve(e){if(!e)return"";const t=String(e).trim();return/^[甲乙丙丁戊己庚辛壬癸]$/.test(t)?t:ge[t]||t}function xe(e){if(!e)return"";const t=String(e).trim();return/^[子丑寅卯辰巳午未申酉戌亥]$/.test(t)?t:be[t]||t}function ye(e){return e?Array.isArray(e)?e.map(t=>t||{stem:"",branch:""}):[e.year,e.month,e.day,e.hour].map(t=>t||{stem:"",branch:""}):[]}function M(e){return me[e]||""}function Y(e){return he[e]||""}const Ke=({pillars:e,idPrefix:t=""})=>{const r=ye(e),n=["연","월","일","시"],i=["year","month","day","hour"];return a.jsx("div",{className:"pillars",children:r.map((o,s)=>{const c=ve(o?.stem),p=xe(o?.branch),d=M(c)||M(o?.stem),l=M(p)||M(o?.branch),f=i[s],h=t?`${t}-${f}`:void 0;return a.jsxs("div",{className:"pillar","data-type":f,id:h,children:[a.jsx("h3",{children:n[s]}),a.jsxs("div",{className:"pill",children:[a.jsx("span",{className:d,children:c||"—"}),a.jsx("span",{children:"·"}),a.jsx("span",{className:l,children:p||"—"})]}),a.jsx("div",{className:"gx",children:[Y(d),Y(l)].filter(Boolean).join(" · ")})]},s)})})};function A(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function I(e){return e=e.replace(/\[([^\]]+)\]\((https?:\/\/[^\s)]+)\)/g,(t,r,n)=>`<a href="${A(n)}" target="_blank" rel="noopener noreferrer">${A(r)}</a>`),e=e.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*([^*]+)\*/g,"<em>$1</em>"),e=e.replace(/`([^`]+)`/g,"<code>$1</code>"),e}function we(e){if(!e)return"";const t=String(e).replace(/\r\n/g,`
`).split(`
`);let r=0,n="";const i=s=>{const c=[];for(;r<t.length&&s(t[r]);)c.push(t[r++]);return c},o=s=>{const c=s.join(`
`).trim();if(!c)return;const p=c.split(/\n{2,}/).map(d=>`<p>${I(A(d))}</p>`);n+=p.join("")};for(;r<t.length;){const s=t[r];if(/^\s*(-{3,}|\*{3,}|_{3,})\s*$/.test(s)){r++,n+="<hr/>";continue}const c=s.match(/^\s*(#{1,3})\s+(.+)$/);if(c){r++;const d=c[1].length,l=c[2].trim(),f=I(A(l));n+=`<h${d+1}>${f}</h${d+1}>`;continue}if(/^\s*>/.test(s)){const l=i(f=>/^\s*>/.test(f)).map(f=>f.replace(/^\s*>\s?/,"")).join(`
`).split(/\n{2,}/).map(f=>`<p>${I(A(f))}</p>`);n+=`<blockquote>${l.join("")}</blockquote>`;continue}if(/^\s*\d+\.\s+/.test(s)){const d=i(l=>/^\s*\d+\.\s+/.test(l)).map(l=>l.replace(/^\s*\d+\.\s+/,"")).map(l=>`<li>${I(A(l))}</li>`).join("");n+=`<ol>${d}</ol>`;continue}if(/^\s*([-*•])\s+/.test(s)){const d=i(l=>/^\s*([-*•])\s+/.test(l)).map(l=>l.replace(/^\s*([-*•])\s+/,"")).map(l=>`<li>${I(A(l))}</li>`).join("");n+=`<ul>${d}</ul>`;continue}const p=[];for(;r<t.length&&!/^\s*$/.test(t[r]);)p.push(t[r++]);for(o(p);r<t.length&&/^\s*$/.test(t[r]);)r++}return n}const Se=()=>a.jsxs("div",{className:"ai-loading",role:"img","aria-label":"로딩 중",children:[a.jsxs("svg",{className:"ai-spinner",width:"96",height:"96",viewBox:"0 0 96 96",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"aiGrad",x1:"0",y1:"0",x2:"1",y2:"1",children:[a.jsx("stop",{offset:"0%",stopColor:"#0a84ff"}),a.jsx("stop",{offset:"50%",stopColor:"#7a5af8"}),a.jsx("stop",{offset:"100%",stopColor:"#0fa958"})]})}),a.jsx("circle",{cx:"48",cy:"48",r:"32",fill:"none",stroke:"url(#aiGrad)",strokeWidth:"4",strokeLinecap:"round",strokeDasharray:"160 60",children:a.jsx("animate",{attributeName:"stroke-dashoffset",from:"0",to:"-440",dur:"1.2s",repeatCount:"indefinite"})}),a.jsx("circle",{cx:"48",cy:"48",r:"24",fill:"none",stroke:"rgba(0,0,0,.08)",strokeWidth:"2",strokeDasharray:"4 6",children:a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 48 48",to:"360 48 48",dur:"6s",repeatCount:"indefinite"})}),a.jsx("g",{transform:"translate(48,48)",children:a.jsxs("circle",{cx:"0",cy:"-24",r:"3.2",fill:"rgba(10,132,255,.85)",children:[a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0",to:"360",dur:"1.6s",repeatCount:"indefinite"}),a.jsx("animate",{attributeName:"r",values:"3.2;5;3.2",dur:"1.6s",repeatCount:"indefinite"})]})}),a.jsx("g",{transform:"translate(48,48)",children:a.jsxs("circle",{cx:"0",cy:"18",r:"2.8",fill:"rgba(122,90,248,.9)",children:[a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"360",to:"0",dur:"2.4s",repeatCount:"indefinite"}),a.jsx("animate",{attributeName:"r",values:"2.8;4;2.8",dur:"2.4s",repeatCount:"indefinite"})]})})]}),a.jsx("style",{children:`
      .ai-loading { display:grid; place-items:center; padding:10px 0 6px; }
      .ai-spinner { filter: drop-shadow(0 4px 18px rgba(122,90,248,.25)); }
      @media (prefers-reduced-motion: reduce){
        .ai-spinner animate, .ai-spinner animateTransform { display:none; }
      }
    `})]}),et=({content:e,isLoading:t,error:r})=>{if(t)return a.jsxs("div",{className:"ai-fortune",children:[a.jsxs("div",{className:"content",children:[a.jsx(Se,{}),a.jsx("p",{"aria-live":"polite",children:"AI가 내용을 준비하는 중…"})]}),a.jsx("style",{children:`
          .ai-fortune .content { max-width:none; width:100%; margin:0; padding-right:0; box-sizing:border-box; }
          .ai-fortune .content p { margin: 10px 0; text-align:center; color: var(--ink-soft, #666); }
        `})]});if(r)return a.jsxs("div",{className:"ai-fortune",children:[a.jsxs("div",{className:"content",role:"alert",children:[a.jsx("p",{children:"사주 풀이 생성 중 오류가 발생했습니다."}),a.jsxs("p",{children:[a.jsx("strong",{children:"오류 내용:"})," ",String(r)]}),a.jsx("p",{children:"API 키/네트워크 또는 CORS 설정을 확인해주세요."})]}),a.jsx("style",{children:`
          .ai-fortune .content { max-width:none; width:100%; margin:0; padding-right:0; box-sizing:border-box; }
          .ai-fortune .content p { margin: 8px 0; line-height:1.7; }
        `})]});if(!e)return null;const n=we(e),i={"@context":"https://schema.org","@type":"Article",headline:"AI 사주 풀이",author:{"@type":"Person",name:"AI Fortune"},datePublished:new Date().toISOString(),articleSection:"Horoscope",inLanguage:"ko"};return a.jsxs("div",{className:"ai-fortune",children:[a.jsxs("article",{className:"content",itemScope:!0,itemType:"https://schema.org/Article",children:[a.jsx("div",{itemProp:"articleBody",dangerouslySetInnerHTML:{__html:n}}),a.jsx("meta",{itemProp:"author",content:"AI Fortune"})]}),a.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(i)}}),a.jsx("style",{children:`
        .ai-fortune .content {
          max-width: none !important;
          width: 100% !important;
          margin: 0 !important;
          padding-right: 0 !important;
          box-sizing: border-box;
          line-height: 1.85;
          overflow-wrap: anywhere;
        }
        .ai-fortune .content h2,
        .ai-fortune .content h3,
        .ai-fortune .content h4 { text-align: left; }
        .ai-fortune .content p { margin: 10px 0; }
        .ai-fortune .content ul, 
        .ai-fortune .content ol { margin: 8px 0 8px 18px; }
        .ai-fortune .content a { color: var(--accent, #7a5af8); text-decoration: none; }
        .ai-fortune .content a:hover { text-decoration: underline; }
      `})]})};function tt({show:e=!1,title:t="준비 중입니다…",message:r="조금만 기다려 주세요.",respectReducedMotion:n=!0,forceHaptics:i=!1}){const o=typeof navigator<"u"&&typeof navigator.vibrate=="function",[s,c]=b.useState(!1);b.useEffect(()=>{if(n)try{const u=window.matchMedia("(prefers-reduced-motion: reduce)"),v=()=>c(!!u.matches);return v(),u.addEventListener?u.addEventListener("change",v):u.addListener(v),()=>{u.removeEventListener?u.removeEventListener("change",v):u.removeListener(v)}}catch{}},[n]);const p=b.useMemo(()=>{try{return i||navigator?.maxTouchPoints>0||window.matchMedia&&window.matchMedia("(hover: none) and (pointer: coarse)").matches}catch{return!!i}},[i]),[d,l]=b.useState(!1),f=()=>{try{const u=navigator.userActivation;return!!(u?.isActive||u?.hasBeenActive)}catch{return!1}};b.useEffect(()=>{e&&f()&&queueMicrotask(()=>l(!0))},[e]),b.useEffect(()=>{if(!e||d)return;const u=()=>{l(!0)};return window.addEventListener("pointerdown",u,{capture:!0,passive:!0}),window.addEventListener("keydown",u,{capture:!0}),window.addEventListener("touchstart",u,{capture:!0,passive:!0}),()=>{window.removeEventListener("pointerdown",u,{capture:!0}),window.removeEventListener("keydown",u,{capture:!0}),window.removeEventListener("touchstart",u,{capture:!0})}},[e,d]);const h=b.useRef(null),g=b.useRef(e),m=(u=20)=>{if(!o||!d&&!f()||s&&!i)return!1;try{return navigator.vibrate(u)?!0:Array.isArray(u)?navigator.vibrate(20)||!1:navigator.vibrate([20,30,20])||!1}catch{return!1}},j=()=>{if(h.current&&(clearInterval(h.current),h.current=null),o&&(d||f())&&!(s&&!i))try{navigator.vibrate(0)}catch{}};return b.useEffect(()=>(e&&p&&o&&(d||f())&&!(s&&!i)?(m(20),h.current||(h.current=setInterval(()=>{m(20)},2e3))):j(),g.current&&!e&&(m(0),setTimeout(()=>m([25,35,25]),0)),g.current=e,()=>{j()}),[e,p,o,d,s,i]),b.useEffect(()=>{if(!e)return;const u=()=>{document.visibilityState==="hidden"?j():e&&(d||f())&&(m(20),h.current||(h.current=setInterval(()=>m(20),2e3)))};return document.addEventListener("visibilitychange",u),()=>document.removeEventListener("visibilitychange",u)},[e,d]),b.useEffect(()=>{e&&(o||console.info("[FullScreenLoader] 이 환경은 navigator.vibrate를 지원하지 않습니다(iOS Safari 등)."))},[e,o]),e?a.jsxs("div",{role:"status","aria-live":"polite",className:`fs-loader ${s?"reduce":"animate"}`,children:[a.jsxs("div",{className:"fs-loader__inner",children:[a.jsxs("div",{className:"solarsys",role:"img","aria-label":"로딩 중: 태양계 애니메이션",children:[a.jsx("div",{className:"sun","aria-hidden":"true"}),a.jsx("div",{className:"orbit orbit--1","aria-hidden":"true",children:a.jsx("div",{className:"planet planet--1"})}),a.jsx("div",{className:"orbit orbit--2","aria-hidden":"true",children:a.jsx("div",{className:"planet planet--2"})}),a.jsx("div",{className:"orbit orbit--3","aria-hidden":"true",children:a.jsx("div",{className:"planet planet--3"})})]}),a.jsx("h3",{className:"fs-loader__title",children:t}),a.jsx("p",{className:"fs-loader__msg",children:r}),a.jsx("span",{style:{marginTop:2,fontSize:11,opacity:.45,userSelect:"none",display:"block"},children:o?d||f()?"진동 활성화됨":"화면을 한 번 터치하면 진동이 켜집니다":"이 기기는 진동 미지원"})]}),a.jsx("style",{children:`
        .fs-loader { position: fixed; inset: 0; width: 100vw; height: 100vh; z-index: 9999;
          display: grid; place-items: center; background: rgba(250,250,252,.88); backdrop-filter: blur(4px);
          contain: layout style paint; }
        @media (prefers-color-scheme: dark){ .fs-loader { background: rgba(11,15,25,.72); } }

        .fs-loader__inner { display: grid; justify-items: center; gap: 14px; padding: 24px 28px; border-radius: 16px;
          background: var(--surface,#fff); border: 1px solid var(--border,#e5e7eb);
          box-shadow: 0 1px 2px rgba(0,0,0,.04), 0 18px 50px rgba(0,0,0,.10);
          text-align: center; max-width: min(88vw,520px); transform: translateZ(0); will-change: transform; }
        @media (prefers-color-scheme: dark){ .fs-loader__inner { background: #0b0f19; border-color: #253041; } }

        .fs-loader__title { margin: 2px 0 0; font-size: clamp(18px,2.2vw,20px); font-weight: 800;
          letter-spacing: -0.01em; color: var(--ink-strong,#111827); }
        .fs-loader__msg { margin: 0; font-size: 14px; color: var(--ink-soft,#6b7280); }
        @media (prefers-color-scheme: dark){
          .fs-loader__title { color: #e5e7eb; }
          .fs-loader__msg { color: #9aa4b2; }
        }

        .solarsys { --size: clamp(84px,16vw,120px); --sun: calc(var(--size)*0.28);
          --o1: calc(var(--size)*0.40); --o2: calc(var(--size)*0.64); --o3: calc(var(--size)*0.84);
          --spin1: 7s; --spin2: 11s; --spin3: 16s; --pulse: 2.6s;
          position: relative; width: var(--size); height: var(--size);
          display: grid; place-items: center; user-select: none; pointer-events: none;
          transform: translateZ(0); will-change: transform; }
        .fs-loader.reduce .solarsys { --spin1: 11s; --spin2: 16s; --spin3: 24s; --pulse: 4.2s; }

        .solarsys .sun { width: var(--sun); height: var(--sun); border-radius: 50%;
          background: radial-gradient(circle at 30% 30%, #ffd166 0%, #fca311 45%, #f59e0b 60%, #ef7f00 100%);
          box-shadow: 0 0 12px 4px rgba(255,184,0,.35), 0 0 40px 8px rgba(255,184,0,.20);
          animation: sun-pulse var(--pulse) ease-in-out infinite; }

        .solarsys .orbit { position: absolute; display: grid; place-items: center; border-radius: 50%;
          border: 1px dashed rgba(125,130,155,.25); }
        .solarsys .orbit--1 { width: var(--o1); height: var(--o1); animation: spin var(--spin1) linear infinite; }
        .solarsys .orbit--2 { width: var(--o2); height: var(--o2); animation: spin var(--spin2) linear infinite reverse; }
        .solarsys .orbit--3 { width: var(--o3); height: var(--o3); animation: spin var(--spin3) linear infinite; }

        .solarsys .planet { position: absolute; top: 0; transform: translateY(-50%); border-radius: 50%;
          box-shadow: 0 2px 6px rgba(0,0,0,.12); }
        .solarsys .planet--1 { width: calc(var(--size)*0.08); height: calc(var(--size)*0.08);
          background: radial-gradient(circle at 35% 35%, #9ae6b4 0%, #22c55e 70%); }
        .solarsys .planet--2 { width: calc(var(--size)*0.10); height: calc(var(--size)*0.10);
          background: radial-gradient(circle at 35% 35%, #93c5fd 0%, #3b82f6 70%); }
        .solarsys .planet--3 { width: calc(var(--size)*0.12); height: calc(var(--size)*0.12);
          background: radial-gradient(circle at 35% 35%, #fca5a5 0%, #ef4444 70%); }

        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes sun-pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.05); } }
      `})]}):null}const N=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],R=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],L={甲:"wood",乙:"wood",丙:"fire",丁:"fire",戊:"earth",己:"earth",庚:"metal",辛:"metal",壬:"water",癸:"water"},O={甲:1,丙:1,戊:1,庚:1,壬:1,乙:0,丁:0,己:0,辛:0,癸:0},je={子:"water",丑:"earth",寅:"wood",卯:"wood",辰:"earth",巳:"fire",午:"fire",未:"earth",申:"metal",酉:"metal",戌:"earth",亥:"water"},S=(e,t)=>(e%t+t)%t,ke={子:["癸"],丑:["己","癸","辛"],寅:["甲","丙","戊"],卯:["甲","乙"],辰:["戊","乙","癸"],巳:["丙","戊","庚"],午:["丙","己","丁"],未:["己","乙","丁"],申:["戊","壬","庚"],酉:["辛"],戌:["戊","辛","丁"],亥:["戊","甲","壬"]},Ae={子:"癸",丑:"己",寅:"甲",卯:"乙",辰:"戊",巳:"丙",午:"丙",未:"己",申:"庚",酉:"辛",戌:"戊",亥:"壬"},Ee=["장생","목욕","관대","건록","제왕","쇠","병","사","묘","절","태","양"],Ne={甲:11,乙:6,丙:2,丁:9,戊:2,己:9,庚:5,辛:0,壬:8,癸:3},_e={亥:{申:"겁살",卯:"육해살",亥:"망신살",午:"재살"}};function J(e,t){if(!e||!t)return"";const r=L[e],n=L[t],i=O[e],o=O[t];return n===r?i===o?"비견":"겁재":r==="wood"&&n==="fire"||r==="fire"&&n==="earth"||r==="earth"&&n==="metal"||r==="metal"&&n==="water"||r==="water"&&n==="wood"?i===o?"식신":"상관":n==="wood"&&r==="fire"||n==="fire"&&r==="earth"||n==="earth"&&r==="metal"||n==="metal"&&r==="water"||n==="water"&&r==="wood"?i===o?"정인":"편인":r==="wood"&&n==="earth"||r==="fire"&&n==="metal"||r==="earth"&&n==="water"||r==="metal"&&n==="wood"||r==="water"&&n==="fire"?i===o?"편재":"정재":n==="wood"&&r==="earth"||n==="fire"&&r==="metal"||n==="earth"&&r==="water"||n==="metal"&&r==="wood"||n==="water"&&r==="fire"?i===o?"편관":"정관":""}function Ie(e,t){const r=Ne[e];if(r==null)return"";const n=R.indexOf(t);if(n<0)return"";const i=O[e]?1:-1,o=S((n-r)*i,12);return Ee[o]||""}function Re(e,t){const r=_e[e];return r&&r[t]||""}function Te(e,t,r){if(!r||!r.useLocalSolar)return{hour:e,minute:t};const n=typeof r.longitude=="number"?r.longitude:126.9784,i=Math.round((135-n)*4);let o=e*60+t-i;return o=S(o,1440),{hour:Math.floor(o/60),minute:o%60}}function Me(e,t,r){let n=e;(t===1||t===2&&r<4)&&(n=e-1);const o=n-1984;return{stem:N[S(o,10)],branch:R[S(o,12)]}}function Ce(e,t,r,n){let i;t===2&&r>=4||t===3&&r<5?i=2:t===3&&r>=5||t===4&&r<4?i=3:t===4&&r>=4||t===5&&r<5?i=4:t===5&&r>=5||t===6&&r<5?i=5:t===6&&r>=5||t===7&&r<7?i=6:t===7&&r>=7||t===8&&r<7?i=7:t===8&&r>=7||t===9&&r<7?i=8:t===9&&r>=7||t===10&&r<8?i=9:t===10&&r>=8||t===11&&r<7?i=10:t===11&&r>=7||t===12&&r<7?i=11:t===12&&r>=7||t===1&&r<5?i=0:i=1;const o=N.indexOf(n);let s;o===0||o===5?s=2:o===1||o===6?s=4:o===2||o===7?s=6:o===3||o===8?s=8:s=0;const c=S(s+S(i-2,12),10);return{stem:N[c],branch:R[i]}}function $e(e,t,r,n=0,i=0){let o=U(e,t,r);n*60+i>=1410&&(o+=1);const s=U(1912,2,18),c=o-s;return{stem:N[S(c,10)],branch:R[S(c,12)]}}function Le(e,t=0,r=0){const n=t*60+r,i=S(n-1410,1440),o=Math.floor(i/120),s=R[S(o,12)],c=N.indexOf(e);let p;return c===0||c===5?p=0:c===1||c===6?p=2:c===2||c===7?p=4:c===3||c===8?p=6:p=8,{stem:N[S(p+o,10)],branch:s}}function Oe(e,t,r){const n=[[1,5,"소한"],[1,20,"대한"],[2,4,"입춘"],[2,19,"우수"],[3,6,"경칩"],[3,21,"춘분"],[4,5,"청명"],[4,20,"곡우"],[5,6,"입하"],[5,21,"소만"],[6,6,"망종"],[6,21,"하지"],[7,7,"소서"],[7,23,"대서"],[8,7,"입추"],[8,23,"처서"],[9,7,"백로"],[9,23,"추분"],[10,8,"한로"],[10,23,"상강"],[11,7,"입동"],[11,22,"소설"],[12,7,"대설"],[12,22,"동지"]],i=new Date(e,t-1,r);let o=n[0][2];for(const[s,c,p]of n){const d=new Date(e,s-1,c);i>=d&&(o=p)}return{name:o}}function rt(e,t,r,n=0,i=0,o={}){const{hour:s,minute:c}=Te(n,i,o),p=Me(e,t,r),d=Ce(e,t,r,p.stem),l=$e(e,t,r,s,c),f=Le(l.stem,s,c),h=Oe(e,t,r),g=m=>{const j=ke[m.branch]||[],u=Ae[m.branch]||j[0];return{...m,tenGodStem:J(l.stem,m.stem),tenGodBranch:u?J(l.stem,u):"",hiddenStems:j,lifeStage:Ie(l.stem,m.branch),shinsal:Re(l.branch,m.branch)||"",elemStem:L[m.stem],elemBranch:je[m.branch]}};return{year:g(p),month:g(d),day:g(l),hour:g(f),season:h}}const Z=typeof navigator<"u"&&typeof navigator.vibrate=="function";function X(){try{const e=navigator.userActivation;return!!(e?.isActive||e?.hasBeenActive)}catch{return!1}}function z(e=20){if(!Z||!X())return!1;try{return navigator.vibrate(e)?!0:Array.isArray(e)?navigator.vibrate(20)||!1:navigator.vibrate([20,35,20])||!1}catch{return!1}}function Q(){if(Z&&X())try{navigator.vibrate(0)}catch{}}function De(){z(20)}function W(){Q(),z(30)}function q(){Q(),z([25,40,25])}const K=!1,ze="https://cool-shape-9570.idcode1690.workers.dev",Pe=typeof location<"u"&&/github\.io|workers\.dev|vercel\.app|netlify\.app|unse\.news/i.test(location.host),D=K&&!Pe?"/api/ai":`${ze}/chat`;try{console.info("[openaiService] endpoint:",D,"mode=","production","dev=",K)}catch{}const ee="ai_cache_v1:",C=new Map,P=60*1e3,te=60*P,E=24*te;function re(){return Date.now()+9*te}function He(){const e=re(),t=E-e%E;return t>0?t:P}function Be(){const e=re(),r=new Date(e).getUTCDay(),n=e-e%E,i=(7-r)%7,s=n+(i===0?7:i)*E-e;return s>0?s:P}function ne(e){const t=String(e||"").toUpperCase();return t.includes("TODAY")?He():t.includes("SAJU")?365*E:t.includes("COMPAT")?30*E:t.includes("LOTTO")?Be():30*E}function Fe(e){try{return localStorage.getItem(e)}catch{return null}}function Ue(e,t){try{localStorage.setItem(e,t)}catch{}}function V(e){try{localStorage.removeItem(e)}catch{}}function Ge(e){if(!e)return null;const t=ee+e,r=Fe(t);if(!r)return null;try{const{value:n,expireAt:i}=JSON.parse(r);return i&&Date.now()<i?String(n??""):(V(t),null)}catch{return V(t),null}}function Ye(e,t,r){if(!e)return;const n=ee+e,i=Date.now()+(r??ne(e));Ue(n,JSON.stringify({value:String(t??""),expireAt:i}))}async function nt({messages:e,cacheKey:t,model:r="gpt-5.1-mini",temperature:n=.1,top_p:i=1,max_tokens:o=1800,seed:s=777}={}){const c=t?Ge(t):null;if(c!=null&&c!==""){try{console.debug("[openaiService] cache HIT:",t)}catch{}return c}if(t&&C.has(t)){try{console.debug("[openaiService] inflight dedupe:",t)}catch{}return C.get(t)}const p={model:r,messages:e,cacheKey:t,temperature:n,top_p:i,max_tokens:o,seed:s},d=async f=>{const h=await fetch(f,{method:"POST",mode:"cors",credentials:"omit",cache:"no-store",headers:{"content-type":"text/plain;charset=UTF-8"},body:JSON.stringify(p),redirect:"follow",referrerPolicy:"no-referrer"}),g=await h.text();if(!h.ok){let v;try{v=JSON.parse(g)}catch{v={error:g}}const _=v?.error?.message||v?.error||g||"Unknown error";throw new Error(`OpenAI API 오류 (${h.status}): ${typeof _=="string"?_:JSON.stringify(_)}`)}let m;try{m=JSON.parse(g)}catch{m=null}const j=m?.choices?.[0]?.message?.content??(m?"":g),u=String(j??"");return t&&u&&Ye(t,u,ne(t)),u};try{De()}catch{}const l=(async()=>{try{const f=await d(D);try{W()}catch{}return f}catch(f){if((f?.name==="TypeError"||/Failed to fetch/i.test(String(f?.message||"")))&&D!=="/api/ai")try{console.warn("[openaiService] primary failed, fallback -> /api/ai",f);const g=await d("/api/ai");try{W()}catch{}return g}catch(g){try{q()}catch{}throw g}try{q()}catch{}throw f}})();t&&C.set(t,l);try{return await l}finally{t&&C.delete(t)}}const Je={},$="운세뉴스",We=Je?.VITE_SITE_URL&&String(void 0)||(typeof window<"u"?window.location.origin:"https://idcode1690.github.io/unse");function y(e,t){const r=Object.entries(t).map(([i,o])=>`[${i}="${o}"]`).join("");let n=document.head.querySelector(`${e}${r}`);return n||(n=document.createElement(e),Object.entries(t).forEach(([i,o])=>n.setAttribute(i,o)),document.head.appendChild(n)),n}function qe(e){return!e||!e.trim()?$:e.includes($)?e:`${e} | ${$}`}function at({title:e,description:t,path:r="/",image:n="/og-image.png",noIndex:i=!1}){const o=`${We}${r.startsWith("#")||r.startsWith("/")?r:`/${r}`}`,s=qe(e);document.title=s,t&&y("meta",{name:"description"}).setAttribute("content",t),y("meta",{name:"robots"}).setAttribute("content",i?"noindex,nofollow":"index,follow"),y("link",{rel:"canonical"}).setAttribute("href",o),y("meta",{property:"og:title"}).setAttribute("content",s),y("meta",{property:"og:description"}).setAttribute("content",t||""),y("meta",{property:"og:type"}).setAttribute("content","website"),y("meta",{property:"og:url"}).setAttribute("content",o),y("meta",{property:"og:image"}).setAttribute("content",n),y("meta",{name:"twitter:card"}).setAttribute("content","summary_large_image"),y("meta",{name:"twitter:title"}).setAttribute("content",s),y("meta",{name:"twitter:description"}).setAttribute("content",t||""),y("meta",{name:"twitter:image"}).setAttribute("content",n)}var Ve=pe();function it({isOpen:e,onClose:t,pageTitle:r="운세뉴스",shareText:n="유용했다면 지인에게 공유해보세요!"}){const i=b.useRef(null),o=b.useRef(null),s=b.useRef(null),c=b.useRef(null),p=b.useRef(""),d=()=>{const{origin:w,pathname:x}=window.location;return`${w}${x}#/`},l=()=>{try{t?.()}catch{}},f=w=>{w.target===i.current&&l()},h=()=>{try{window.location.hash="#/"}finally{l()}},g=async()=>{const w=d();if(navigator.share){try{await navigator.share({title:r,text:n,url:w})}catch{}h();return}try{await navigator.clipboard.writeText(w),alert("홈 링크를 클립보드에 복사했습니다.")}catch{try{const x=document.createElement("textarea");x.value=w,x.setAttribute("readonly",""),x.style.position="fixed",x.style.opacity="0",document.body.appendChild(x),x.select(),document.execCommand("copy"),document.body.removeChild(x),alert("홈 링크를 클립보드에 복사했습니다.")}catch{}}finally{h()}};if(b.useEffect(()=>{if(!e)return;try{document.body.classList.remove("scroll-lock")}catch{}p.current=document.body.style.overflow||"",document.body.style.overflow="hidden",c.current=document.activeElement;const w=setTimeout(()=>(s.current||o.current)?.focus(),0),x=k=>{if(k.key==="Escape"&&(k.preventDefault(),l()),k.key==="Tab"){const T=Ze(o.current);if(!T.length){k.preventDefault(),o.current?.focus();return}const B=T[0],F=T[T.length-1];k.shiftKey&&document.activeElement===B?(k.preventDefault(),F.focus()):!k.shiftKey&&document.activeElement===F&&(k.preventDefault(),B.focus())}};return window.addEventListener("keydown",x),()=>{clearTimeout(w),window.removeEventListener("keydown",x),document.body.style.overflow=p.current||"";try{c.current?.focus?.()}catch{}}},[e]),!e)return null;const m=(()=>{try{return window.matchMedia("(prefers-reduced-motion: reduce)").matches}catch{return!1}})(),j={position:"fixed",inset:0,zIndex:1e3,background:"color-mix(in oklab, black 38%, transparent)",display:"grid",placeItems:"center",padding:16,backdropFilter:"blur(2px)",animation:m?void 0:"fadeIn .16s ease-out"},u={width:"min(560px, 94vw)",background:"var(--surface, #fff)",color:"var(--ink, #111827)",border:"1px solid var(--border, #e5e7eb)",borderRadius:16,boxShadow:"0 20px 48px rgba(0,0,0,.16)",overflow:"hidden",outline:"none",display:"grid",gridTemplateRows:"auto 1fr auto",transform:m?"none":"translateY(6px)",animation:m?void 0:"popIn .18s ease-out"},v={padding:"16px 18px 12px",borderBottom:"1px solid var(--border, #e5e7eb)",display:"flex",alignItems:"center",gap:12},_={width:36,height:36,flex:"0 0 36px",display:"grid",placeItems:"center",borderRadius:12,color:"#fff",background:"linear-gradient(135deg, var(--accent, #7a5af8), #0fa958)",boxShadow:"0 6px 20px rgba(122,90,248,.25)",fontSize:18,fontWeight:800},ae={display:"grid",gap:4},ie={margin:0,fontSize:18,fontWeight:800,lineHeight:1.25},oe={margin:0,fontSize:13,color:"var(--ink-soft, #6b7280)"},se={padding:18,display:"grid",gap:12},ce={padding:12,border:"1px solid var(--border, #e5e7eb)",borderRadius:12,background:"var(--surface, #fff)",fontSize:14,color:"var(--ink, #374151)",lineHeight:1.6},le={display:"flex",alignItems:"center",gap:8,padding:10,borderRadius:10,border:"1px dashed var(--border, #e5e7eb)",background:"color-mix(in oklab, var(--surface, #fff) 92%, #7a5af8 8%)",fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',overflow:"hidden"},de={whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:13,opacity:.9},ue={padding:14,borderTop:"1px solid var(--border, #e5e7eb)",display:"flex",justifyContent:"flex-end",gap:8,background:"var(--surface, #fff)"},H=d(),fe=a.jsxs("div",{ref:i,style:j,onClick:f,"data-testid":"share-backdrop",children:[a.jsxs("div",{ref:o,role:"dialog","aria-modal":"true","aria-labelledby":"share-title","aria-describedby":"share-desc",style:u,tabIndex:-1,onClick:w=>w.stopPropagation(),"data-testid":"share-modal",children:[a.jsxs("div",{style:v,children:[a.jsx("div",{style:_,"aria-hidden":!0,children:"🔗"}),a.jsxs("div",{style:ae,children:[a.jsx("h3",{id:"share-title",style:ie,children:"공유하기"}),a.jsx("p",{style:oe,children:"친구/가족에게 운세뉴스를 알려보세요"})]})]}),a.jsxs("div",{style:se,children:[a.jsxs("div",{id:"share-desc",style:ce,children:[a.jsx("strong",{style:{fontWeight:800},children:r}),a.jsx("div",{style:{marginTop:6},children:n})]}),a.jsxs("div",{style:le,"aria-label":"공유 링크",children:[a.jsx("span",{style:{opacity:.6},children:"URL"}),a.jsx("span",{style:de,title:H,children:H})]})]}),a.jsxs("div",{style:ue,children:[a.jsx(G,{variant:"text",onClick:l,ref:s,"data-testid":"share-cancel",children:"다음에"}),a.jsx(G,{onClick:g,"data-testid":"share-confirm",children:"공유하기"})]})]}),a.jsx("style",{children:`
        @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
        @keyframes popIn {
          from { opacity: .001; transform: translateY(10px) scale(.98) }
          to   { opacity: 1;    transform: translateY(0)  scale(1) }
        }
        @media (prefers-reduced-motion: reduce){
          @keyframes fadeIn { from { opacity: 1 } to { opacity: 1 } }
          @keyframes popIn  { from { transform:none } to { transform:none } }
        }
      `})]});return Ve.createPortal(fe,document.body)}function Ze(e){if(!e)return[];const t=["a[href]","button:not([disabled])","textarea:not([disabled])","input:not([disabled])","select:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(",");return Array.from(e.querySelectorAll(t)).filter(r=>{const n=window.getComputedStyle(r);return n.display!=="none"&&n.visibility!=="hidden"})}export{et as A,tt as F,Ke as P,it as S,nt as a,rt as c,at as s};

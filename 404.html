<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Redirecting…</title>
    <meta name="robots" content="noindex" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; connect-src 'self'; img-src 'self' data: blob:; style-src 'self' 'unsafe-inline'; object-src 'none'"
    />
    <script>
      (function (l) {
        try {
          // 현재 경로/쿼리/해시
          var path  = l.pathname || '/';
          var search = l.search || '';
          var hash   = l.hash   || '';

          // 1) 루트(/)에서는 절대 리다이렉트하지 않음 (무한 루프 방지)
          if (path === '/' || path === '') return;

          // 2) 정적 파일처럼 보이는 경우는 개입하지 않음
          //    - 확장자(.css/.js/.png...)가 있거나
          //    - /assets/ 아래거나
          //    - 서비스워커/매니페스트/RSS/Sitemap/robots 등 실파일
          var looksLikeFile =
            /\.[a-z0-9]{1,8}$/i.test(path) ||           // /foo/bar.png, /app.js 등
            /^\/assets\//.test(path)      ||             // 정적 번들
            path === '/sw.js'             ||
            path === '/site.webmanifest'  ||
            path === '/robots.txt'        ||
            path === '/rss.xml'           ||
            path === '/sitemap.xml';

          if (looksLikeFile) return;

          // 3) 이미 /?p= 형태로 들어온 경우면 다시 돌리지 않음
          var usp = new URLSearchParams(search);
          if (usp.has('p')) return;

          // 4) SPA 라우트로 추정되면 루트로 보내되, 원래 전체 경로를 p로 넘김
          var full = path + search + hash; // 예: /result/?q=1#top
          // origin + '/' 로 정확히 루트로
          var target = l.origin.replace(/\/+$/, '') + '/?p=' + encodeURIComponent(full);

          // 히스토리를 남기지 않고 바꿈
          l.replace(target);
        } catch (e) {
          // 혹시 에러가 나도 빈 화면 방지: 최후의 수단으로 루트로 이동
          try {
            location.replace('/');
          } catch {}
        }
      })(window.location);
    </script>
  </head>
  <body></body>
</html>
